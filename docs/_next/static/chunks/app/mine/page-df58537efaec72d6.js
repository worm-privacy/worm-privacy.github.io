(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[933],{6270:function(e,t,n){Promise.resolve().then(n.bind(n,6582))},6582:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eb}});var a=n(7437),r=n(6900),s=n(6070),o=n(2869),l=n(2660),i=n(9322),c=n(1804),d=n(7168),m=n(6399),u=n(9232),g=n(5805),p=n(7414),h=n(7648),f=n(2265),x=n(7593),b=n(6366);let v=(0,f.createContext)(void 0);function y(e){let{children:t}=e,[n,r]=(0,f.useState)(!1),[s,o]=(0,f.useState)(null),[l,i]=(0,f.useState)(null),[c,d]=(0,f.useState)(null),[m,u]=(0,f.useState)(null),{networkConfig:g,isNetworkSupported:p,getNetworkByChainId:h}=(0,b.L)(),y=async()=>{try{if(u(null),void 0===window.ethereum)throw Error("MetaMask is not installed. Please install MetaMask to continue.");await window.ethereum.request({method:"eth_requestAccounts"});let e=new x.Q(window.ethereum),t=await e.getSigner(),n=await t.getAddress(),a=await e.getNetwork();if("0x".concat(a.chainId.toString(16))!==g.chainId)try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:g.chainId}]})}catch(e){if(4902===e.code){if("Anvil Local"!==g.chainName)await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:g.chainId,chainName:g.chainName,nativeCurrency:g.nativeCurrency,rpcUrls:g.rpcUrls,blockExplorerUrls:g.blockExplorerUrls}]});else throw Error("Please start your local Anvil node and add the network manually")}else throw e}i(e),d(t),o(n),r(!0),console.log("[v0] Wallet connected:",n)}catch(e){console.error("[v0] Wallet connection error:",e),u(e.message||"Failed to connect wallet"),r(!1),o(null),i(null),d(null)}},w=()=>{r(!1),o(null),i(null),d(null),u(null),console.log("[v0] Wallet disconnected")},N=async()=>{if(void 0!==window.ethereum&&n)try{let e=new x.Q(window.ethereum),t=await e.getSigner();i(e),d(t),console.log("[v0] Provider updated for network change")}catch(e){console.error("[v0] Error updating provider:",e)}};return(0,f.useEffect)(()=>{if(void 0!==window.ethereum){let e=e=>{0===e.length?w():e[0]!==s&&y()},t=async e=>{console.log("[v0] Network changed to:",e),h(e)?await N():(u("Unsupported network. Please switch to Sepolia or Anvil."),w())};return window.ethereum.on("accountsChanged",e),window.ethereum.on("chainChanged",t),()=>{window.ethereum.removeListener("accountsChanged",e),window.ethereum.removeListener("chainChanged",t)}}},[s,h,n]),(0,f.useEffect)(()=>{(async()=>{if(void 0!==window.ethereum)try{(await window.ethereum.request({method:"eth_accounts"})).length>0&&await y()}catch(e){console.error("[v0] Error checking wallet connection:",e)}})()},[g]),(0,a.jsx)(v.Provider,{value:{isConnected:n,address:s,provider:l,signer:c,connectWallet:y,disconnectWallet:w,error:m},children:t})}function w(){let e=(0,f.useContext)(v);if(void 0===e)throw Error("useWallet must be used within a WalletProvider");return e}var N=n(3032),j=n(407),E=n(401),S=n(519),C=n(4508);let k=N.fC,B=N.xz;N.ZA,N.Uv,N.Tr,N.Ee,f.forwardRef((e,t)=>{let{className:n,inset:r,children:s,...o}=e;return(0,a.jsxs)(N.fF,{ref:t,className:(0,C.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",n),...o,children:[s,(0,a.jsx)(j.Z,{className:"ml-auto"})]})}).displayName=N.fF.displayName,f.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(N.tu,{ref:t,className:(0,C.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...r})}).displayName=N.tu.displayName;let A=f.forwardRef((e,t)=>{let{className:n,sideOffset:r=4,...s}=e;return(0,a.jsx)(N.Uv,{children:(0,a.jsx)(N.VY,{ref:t,sideOffset:r,className:(0,C.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...s})})});A.displayName=N.VY.displayName;let F=f.forwardRef((e,t)=>{let{className:n,inset:r,...s}=e;return(0,a.jsx)(N.ck,{ref:t,className:(0,C.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",n),...s})});F.displayName=N.ck.displayName,f.forwardRef((e,t)=>{let{className:n,children:r,checked:s,...o}=e;return(0,a.jsxs)(N.oC,{ref:t,className:(0,C.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),checked:s,...o,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(N.wU,{children:(0,a.jsx)(E.Z,{className:"h-4 w-4"})})}),r]})}).displayName=N.oC.displayName,f.forwardRef((e,t)=>{let{className:n,children:r,...s}=e;return(0,a.jsxs)(N.Rk,{ref:t,className:(0,C.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...s,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(N.wU,{children:(0,a.jsx)(S.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=N.Rk.displayName,f.forwardRef((e,t)=>{let{className:n,inset:r,...s}=e;return(0,a.jsx)(N.__,{ref:t,className:(0,C.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",n),...s})}).displayName=N.__.displayName,f.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(N.Z0,{ref:t,className:(0,C.cn)("-mx-1 my-1 h-px bg-muted",n),...r})}).displayName=N.Z0.displayName;var _=n(9202),T=n(1239),I=n(875);let R={sepolia:{name:"Sepolia",icon:(0,a.jsx)(_.Z,{className:"w-4 h-4"}),color:"text-blue-400"},anvil:{name:"Anvil",icon:(0,a.jsx)(T.Z,{className:"w-4 h-4"}),color:"text-orange-400"}};function M(){let{selectedNetwork:e,switchNetwork:t}=(0,b.L)(),[n,r]=(0,f.useState)(null),s=async n=>{if(n!==e){r(n);try{await t(n)}catch(e){console.error("Failed to switch network:",e)}finally{r(null)}}},l=R[e];return(0,a.jsxs)(k,{children:[(0,a.jsx)(B,{asChild:!0,children:(0,a.jsx)(o.z,{variant:"outline",size:"sm",className:"bg-gray-900/50 border-gray-700 text-gray-300 hover:bg-gray-800/50",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:l.color,children:l.icon}),(0,a.jsx)("span",{className:"hidden sm:inline",children:l.name}),(0,a.jsx)(I.Z,{className:"w-3 h-3"})]})})}),(0,a.jsx)(A,{align:"end",className:"bg-gray-900 border-gray-700",children:Object.entries(R).map(t=>{let[r,o]=t;return(0,a.jsx)(F,{onClick:()=>s(r),disabled:n===r,className:"text-gray-300 hover:bg-gray-800 focus:bg-gray-800",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:o.color,children:o.icon}),(0,a.jsx)("span",{children:o.name}),e===r&&(0,a.jsx)("div",{className:"ml-auto w-2 h-2 bg-green-400 rounded-full"}),n===r&&(0,a.jsx)("div",{className:"ml-auto w-3 h-3 border border-gray-400 border-t-transparent rounded-full animate-spin"})]})},r)})})]})}var z=n(5810),Z=n(1662),P=n(6110);let O=f.forwardRef((e,t)=>{let{className:n,type:r,...s}=e;return(0,a.jsx)("input",{type:r,className:(0,C.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:t,...s})});O.displayName="Input";var H=n(6394),U=n(535);let W=(0,U.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),q=f.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(H.f,{ref:t,className:(0,C.cn)(W(),n),...r})});q.displayName=H.f.displayName;var G=n(3618);function J(){let[e,t]=(0,f.useState)(null),[n,a]=(0,f.useState)(null),[r,s]=(0,f.useState)(null),[o,l]=(0,f.useState)(!1),i=(0,f.useCallback)(async t=>{if(t.length>0){if(e)try{let n=await e.getSigner();a(n),s(t[0]),l(!0)}catch(e){console.error("Failed to get signer:",e)}}else s(null),a(null),l(!1)},[e]);(0,f.useEffect)(()=>{(async()=>{if(window.ethereum){let e=new x.Q(window.ethereum);t(e);try{if((await e.listAccounts()).length>0){let t=await e.getSigner();a(t),s(await t.getAddress()),l(!0)}}catch(e){console.error("Failed to get accounts:",e)}}})()},[]),(0,f.useEffect)(()=>{if(window.ethereum&&i)return window.ethereum.on("accountsChanged",i),()=>{window.ethereum.removeAllListeners("accountsChanged")}},[i]);let c=async()=>{if(e)try{await e.send("eth_requestAccounts",[]);let t=await e.getSigner();a(t),s(await t.getAddress()),l(!0)}catch(e){console.error("Failed to connect:",e)}};return{provider:e,signer:n,address:r,isConnected:o,connect:c}}function L(e,t){let{provider:n,signer:a}=J(),[r,s]=(0,f.useState)(null);(0,f.useEffect)(()=>{n&&e&&t&&s(new z.CH(e,t,a||n))},[n,a,e]);let o=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!r)return null;try{return await r[e](...t)}catch(t){var n;if((null==t?void 0:t.code)==="NETWORK_ERROR"&&(null==t?void 0:null===(n=t.message)||void 0===n?void 0:n.includes("network changed")))return console.log("[v0] Network changed during ".concat(e," call, ignoring error")),null;return console.error("Error calling ".concat(e,":"),t),null}},l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!r||!a)return null;try{let n;console.log("[v0] Attempting ".concat(e," with args:"),t);let s=await a.provider.getNetwork(),o=31337n===s.chainId||1337n===s.chainId;try{let a=await r[e].estimateGas(...t);console.log("[v0] Estimated gas for ".concat(e,":"),a.toString()),n=o?150n*a/100n:120n*a/100n,console.log("[v0] Using gas limit for ".concat(e,":"),n.toString())}catch(t){console.warn("[v0] Gas estimation failed for ".concat(e,":"),t),n=o?500000n:300000n,console.log("[v0] Using fallback gas limit for ".concat(e,":"),n.toString())}let l=await r[e](...t,{gasLimit:n});return console.log("[v0] ".concat(e," transaction sent:"),l.hash),l}catch(a){var n;if(console.error("[v0] Error calling ".concat(e,":"),a),(null==a?void 0:a.code)===-32603||(null==a?void 0:null===(n=a.message)||void 0===n?void 0:n.includes("Internal JSON-RPC error"))){console.log("[v0] RPC error calling ".concat(e,", trying alternative approach"));try{let n=await r[e](...t,{gasLimit:800000n,type:0});return console.log("[v0] Alternative approach succeeded:",n.hash),n}catch(n){console.error("[v0] Alternative approach also failed for ".concat(e,":"),n);try{console.log("[v0] Trying ".concat(e," with no gas options as final fallback"));let n=await r[e](...t);return console.log("[v0] No-gas-options approach succeeded:",n.hash),n}catch(t){throw console.error("[v0] All approaches failed for ".concat(e,":"),t),t}}}throw a}};return{contract:r,readContract:o,writeContract:l}}function K(e){let{children:t,bethBalance:n,currentEpoch:r}=e,[s,l]=(0,f.useState)(!1),[c,d]=(0,f.useState)(""),[m,u]=(0,f.useState)(""),[g,p]=(0,f.useState)(!1),[h,x]=(0,f.useState)(null),[v,y]=(0,f.useState)(!1),[w,N]=(0,f.useState)(!1),{address:j}=J(),{networkConfig:E}=(0,b.L)(),{readContract:S,writeContract:C}=L(E.contracts.worm,[{name:"approximate",type:"function",stateMutability:"view",inputs:[{name:"_amountPerEpoch",type:"uint256"},{name:"_numEpochs",type:"uint256"}],outputs:[{name:"",type:"uint256"}]},{name:"participate",type:"function",stateMutability:"nonpayable",inputs:[{name:"_amountPerEpoch",type:"uint256"},{name:"_numEpochs",type:"uint256"}],outputs:[]}]),{readContract:k,writeContract:B}=L(E.contracts.beth,[{name:"allowance",type:"function",stateMutability:"view",inputs:[{name:"owner",type:"address"},{name:"spender",type:"address"}],outputs:[{name:"",type:"uint256"}]},{name:"approve",type:"function",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{name:"",type:"bool"}]},{name:"balanceOf",type:"function",stateMutability:"view",inputs:[{name:"account",type:"address"}],outputs:[{name:"",type:"uint256"}]},{name:"name",type:"function",stateMutability:"view",inputs:[],outputs:[{name:"",type:"string"}]},{name:"symbol",type:"function",stateMutability:"view",inputs:[],outputs:[{name:"",type:"string"}]},{name:"decimals",type:"function",stateMutability:"view",inputs:[],outputs:[{name:"",type:"uint8"}]},{name:"totalSupply",type:"function",stateMutability:"view",inputs:[],outputs:[{name:"",type:"uint256"}]}]),A=(Number.parseFloat(c)||0)*(Number.parseFloat(m)||0),F=A<=(Number.parseFloat(n)||0),_=c&&m&&Number.parseFloat(c)>0&&Number.parseFloat(m)>0;(0,f.useEffect)(()=>{let e=new AbortController;return(async()=>{if(c&&m&&Number.parseFloat(c)>0&&Number.parseFloat(m)>0&&j&&E.contracts.worm)try{if(e.signal.aborted)return;console.log("[v0] Calling approximate with:",{amountPerEpoch:Math.floor(1e18*(Number.parseFloat(m)||0)),numEpochs:Number.parseInt(c)||0,contractAddress:E.contracts.worm,userAddress:j});let t=await S("approximate",[BigInt(Math.floor(1e18*(Number.parseFloat(m)||0))),BigInt(Number.parseInt(c)||0)]);if(e.signal.aborted)return;console.log("[v0] Approximate result:",t),x(t)}catch(n){var t;(null==n?void 0:n.code)==="NETWORK_ERROR"&&(null==n?void 0:null===(t=n.message)||void 0===t?void 0:t.includes("network changed"))||console.error("[v0] Error fetching approximate WORM amount:",n),e.signal.aborted||x(null)}else console.log("[v0] Not fetching amount - conditions not met:",{isValid:!!(c&&m&&Number.parseFloat(c)>0&&Number.parseFloat(m)>0),hasAddress:!!j,hasContractAddress:!!E.contracts.worm}),x(null)})(),()=>{e.abort()}},[c,m,j,S,E.contracts.worm]),(0,f.useEffect)(()=>{(async()=>{if(j&&E.contracts.beth&&E.contracts.worm&&A>0)try{let e=await k("allowance",[j,E.contracts.worm]),t=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n=e>=t/BigInt(2),a=BigInt(Math.floor(1e18*A));y(!n&&e<a)}catch(e){console.error("[v0] Error checking allowance:",e),y(!0)}else y(!1)})()},[j,E.contracts.beth,E.contracts.worm,A,k]);let T=async()=>{if(j&&E.contracts.worm){N(!0);try{let e=BigInt("1000000000000000000000000");console.log("[v0] Approving large BETH spend:",{spender:E.contracts.worm,amount:e.toString()});let t=await B("approve",[E.contracts.worm,e]);console.log("[v0] Approval transaction sent:",t.hash),await t.wait(),console.log("[v0] Approval transaction confirmed"),y(!1)}catch(e){console.error("[v0] Approval error:",e)}finally{N(!1)}}},I=async()=>{if(_&&!v){p(!0);try{console.log("[v0] Participating:",{numEpochs:c,bethPerEpoch:m,totalBeth:A});let e=BigInt(Math.floor(1e18*(Number.parseFloat(m)||0))),t=BigInt(Number.parseInt(c)||0);console.log("[v0] Calling participate with:",{amountPerEpoch:e.toString(),numEpochs:t.toString()});let n=await C("participate",[e,t]);console.log("[v0] Participate transaction sent:",n.hash),await n.wait(),console.log("[v0] Participate transaction confirmed"),l(!1),d(""),u("")}catch(e){console.error("[v0] Participate error:",e)}finally{p(!1)}}};return(0,a.jsxs)(P.Vq,{open:s,onOpenChange:l,children:[(0,a.jsx)(P.hg,{asChild:!0,children:t}),(0,a.jsxs)(P.cZ,{className:"bg-green-950/95 border-green-800 text-white",children:[(0,a.jsx)(P.fK,{children:(0,a.jsx)(P.$N,{className:"text-green-300",children:"Participate in Mining"})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(q,{htmlFor:"numEpochs",className:"text-green-300",children:"Number of Epochs"}),(0,a.jsx)(O,{id:"numEpochs",type:"number",value:c,onChange:e=>d(e.target.value),className:"bg-green-950/60 border-green-700 text-white",placeholder:"Enter number of epochs"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(q,{htmlFor:"bethPerEpoch",className:"text-green-300",children:"BETH per Epoch"}),(0,a.jsx)(O,{id:"bethPerEpoch",type:"number",step:"0.0001",value:m,onChange:e=>u(e.target.value),className:"bg-green-950/60 border-green-700 text-white",placeholder:"Enter BETH amount per epoch"})]}),(0,a.jsxs)("div",{className:"bg-green-900/30 border border-green-700 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(G.Z,{className:"w-4 h-4 text-green-400"}),(0,a.jsx)("span",{className:"text-green-300 font-medium",children:"Total BETH Required"})]}),(0,a.jsxs)("div",{className:"text-2xl font-mono text-yellow-300",children:[A.toFixed(4)," BETH"]}),(0,a.jsxs)("div",{className:"text-sm text-gray-400",children:["Your Balance: ",n," BETH"]}),!F&&A>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2 text-red-400",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm",children:"Insufficient BETH balance"})]})]}),c&&m&&Number.parseFloat(c)>0&&Number.parseFloat(m)>0&&(0,a.jsxs)("div",{className:"bg-green-900/30 border border-green-700 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(G.Z,{className:"w-4 h-4 text-green-400"}),(0,a.jsx)("span",{className:"text-green-300 font-medium",children:"Approximate WORM Reward"})]}),(0,a.jsxs)("div",{className:"text-2xl font-mono text-yellow-300",children:[h?(Number(h)/1e18).toFixed(4):"Calculating..."," WORM"]}),(0,a.jsx)("div",{className:"text-sm text-gray-400",children:"Estimated based on current conditions"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(o.z,{variant:"outline",onClick:()=>l(!1),className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-800",children:"Cancel"}),v?(0,a.jsx)(o.z,{onClick:T,disabled:!_||!F||w,className:"flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-semibold",children:w?"Approving...":"Approve BETH"}):(0,a.jsx)(o.z,{onClick:I,disabled:!_||!F||g,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-black font-semibold",children:g?"Participating...":"Participate"})]})]})]})]})}function V(e){let{children:t,currentEpoch:n}=e,[r,s]=(0,f.useState)(!1),[l,c]=(0,f.useState)(""),[d,m]=(0,f.useState)(""),[u,g]=(0,f.useState)(!1),[p,h]=(0,f.useState)(null),{address:x}=J(),{networkConfig:v}=(0,b.L)(),{readContract:y,writeContract:w}=L(v.contracts.worm,[{name:"calculateMintAmount",type:"function",stateMutability:"view",inputs:[{name:"_startingEpoch",type:"uint256"},{name:"_numEpochs",type:"uint256"},{name:"_user",type:"address"}],outputs:[{name:"",type:"uint256"}]},{name:"claim",type:"function",stateMutability:"nonpayable",inputs:[{name:"_startingEpoch",type:"uint256"},{name:"_numEpochs",type:"uint256"}],outputs:[{name:"",type:"uint256"}]}]),N=Number.parseInt(l)||0,j=Number.parseInt(d)||0,E=N+j-1,S=N<n&&E<n,C=l&&d&&S;(0,f.useEffect)(()=>{(async()=>{if(C&&x&&v.contracts.worm)try{console.log("[v0] Calling calculateMintAmount with:",{startingEpoch:N,numEpochs:j,userAddress:x,contractAddress:v.contracts.worm});let e=await y("calculateMintAmount",[BigInt(N),BigInt(j),x]);console.log("[v0] calculateMintAmount result:",e),h(e)}catch(e){console.error("[v0] Error fetching expected WORM amount:",e),h(null)}else console.log("[v0] Not fetching amount - conditions not met:",{isValid:C,hasAddress:!!x,hasContractAddress:!!v.contracts.worm}),h(null)})()},[C,x,N,j,y,v.contracts.worm]);let k=async()=>{if(C){g(!0);try{console.log("[v0] Claiming:",{fromEpoch:l,numEpochs:d});let e=BigInt(N),t=BigInt(j);console.log("[v0] Calling claim with:",{startingEpoch:e.toString(),numEpochs:t.toString()});let n=await w("claim",[e,t]);console.log("[v0] Claim transaction sent:",n.hash),await n.wait(),console.log("[v0] Claim transaction confirmed"),s(!1),c(""),m("")}catch(e){console.error("[v0] Claim error:",e)}finally{g(!1)}}};return(0,a.jsxs)(P.Vq,{open:r,onOpenChange:s,children:[(0,a.jsx)(P.hg,{asChild:!0,children:t}),(0,a.jsxs)(P.cZ,{className:"bg-green-950/95 border-green-800 text-white",children:[(0,a.jsx)(P.fK,{children:(0,a.jsx)(P.$N,{className:"text-green-300",children:"Claim WORM Tokens"})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(q,{htmlFor:"claimFromEpoch",className:"text-green-300",children:"From Epoch"}),(0,a.jsx)(O,{id:"claimFromEpoch",type:"number",value:l,onChange:e=>c(e.target.value),className:"bg-green-950/60 border-green-700 text-white",placeholder:"Enter starting epoch",max:n-1})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(q,{htmlFor:"claimNumEpochs",className:"text-green-300",children:"Number of Epochs"}),(0,a.jsx)(O,{id:"claimNumEpochs",type:"number",value:d,onChange:e=>m(e.target.value),className:"bg-green-950/60 border-green-700 text-white",placeholder:"Enter number of epochs to claim"})]}),l&&d&&!S&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-400",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{className:"text-sm",children:["Can only claim completed epochs (current: ",n,", claiming: ",N,"-",E,")"]})]}),C&&null!==p&&(0,a.jsxs)("div",{className:"bg-green-900/30 border border-green-700 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(G.Z,{className:"w-4 h-4 text-green-400"}),(0,a.jsx)("span",{className:"text-green-300 font-medium",children:"Expected WORM Reward"})]}),(0,a.jsxs)("div",{className:"text-2xl font-mono text-yellow-300",children:[0n===p?"0.0000":(Number(p)/1e18).toFixed(4)," WORM"]}),(0,a.jsxs)("div",{className:"text-sm text-gray-400",children:["Claimable from epochs ",N," to ",E]}),0n===p&&(0,a.jsx)("div",{className:"text-sm text-orange-400 mt-2",children:"No WORM tokens available for these epochs. You may not have participated in mining during this period."})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(o.z,{variant:"outline",onClick:()=>s(!1),className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-800",children:"Cancel"}),(0,a.jsx)(o.z,{onClick:k,disabled:!C||u,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-black font-semibold",children:u?"Claiming...":"Claim"})]})]})]})]})}let Y=(0,U.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),$=f.forwardRef((e,t)=>{let{className:n,variant:r,...s}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:(0,C.cn)(Y({variant:r}),n),...s})});$.displayName="Alert",f.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)("h5",{ref:t,className:(0,C.cn)("mb-1 font-medium leading-none tracking-tight",n),...r})}).displayName="AlertTitle";let D=f.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,C.cn)("text-sm [&_p]:leading-relaxed",n),...r})});D.displayName="AlertDescription";var Q=n(1264),X=n(2135);let ee=Q.fC;Q.ZA;let et=Q.B4,en=f.forwardRef((e,t)=>{let{className:n,children:r,...s}=e;return(0,a.jsxs)(Q.xz,{ref:t,className:(0,C.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",n),...s,children:[r,(0,a.jsx)(Q.JO,{asChild:!0,children:(0,a.jsx)(I.Z,{className:"h-4 w-4 opacity-50"})})]})});en.displayName=Q.xz.displayName;let ea=f.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(Q.u_,{ref:t,className:(0,C.cn)("flex cursor-default items-center justify-center py-1",n),...r,children:(0,a.jsx)(X.Z,{className:"h-4 w-4"})})});ea.displayName=Q.u_.displayName;let er=f.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(Q.$G,{ref:t,className:(0,C.cn)("flex cursor-default items-center justify-center py-1",n),...r,children:(0,a.jsx)(I.Z,{className:"h-4 w-4"})})});er.displayName=Q.$G.displayName;let es=f.forwardRef((e,t)=>{let{className:n,children:r,position:s="popper",...o}=e;return(0,a.jsx)(Q.h_,{children:(0,a.jsxs)(Q.VY,{ref:t,className:(0,C.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",n),position:s,...o,children:[(0,a.jsx)(ea,{}),(0,a.jsx)(Q.l_,{className:(0,C.cn)("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(er,{})]})})});es.displayName=Q.VY.displayName,f.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(Q.__,{ref:t,className:(0,C.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",n),...r})}).displayName=Q.__.displayName;let eo=f.forwardRef((e,t)=>{let{className:n,children:r,...s}=e;return(0,a.jsxs)(Q.ck,{ref:t,className:(0,C.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...s,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(Q.wU,{children:(0,a.jsx)(E.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(Q.eT,{children:r})]})});eo.displayName=Q.ck.displayName,f.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,a.jsx)(Q.Z0,{ref:t,className:(0,C.cn)("-mx-1 my-1 h-px bg-muted",n),...r})}).displayName=Q.Z0.displayName;var el=n(1817),ei=n(9397),ec=n(4882),ed=n(5938),em=n(135),eu=n(1489);let eg=BigInt("21888242871839275222246405745257275088548364400416034343698204186575808495617"),ep=BigInt("0xba44186ee7876b8007d2482cd46cec2d115b780980a6b46f0363f983d892f7e"),eh=BigInt("0xba44186ee7876b8007d2482cd46cec2d115b780980a6b46f0363f983d892f7f");function ef(e){var t,n;let{children:r,onBurnComplete:s}=e,{address:l,signer:i}=w(),{networkConfig:c}=(0,b.L)(),[u,g]=(0,f.useState)(!1),[p,h]=(0,f.useState)([]),[x,v]=(0,f.useState)(!1),[y,N]=(0,f.useState)(0),[j,E]=(0,f.useState)(null),[S,C]=(0,f.useState)(null),[k,B]=(0,f.useState)(null),[A,F]=(0,f.useState)(null),[_,T]=(0,f.useState)(new Set),[I,R]=(0,f.useState)(!1),[M,H]=(0,f.useState)(""),[U,W]=(0,f.useState)(""),[G,J]=(0,f.useState)(!1),[L,K]=(0,f.useState)(!1),[V,Y]=(0,f.useState)(""),[Q,X]=(0,f.useState)({stage:"confirm"}),[ea,er]=(0,f.useState)("https://worm-testnet.metatarz.xyz/proof"),[ef,ex]=(0,f.useState)(""),[eb,ev]=(0,f.useState)(!1),[ey,ew]=(0,f.useState)(!1),eN="burn-key-results-".concat(l),ej=e=>{try{l&&localStorage.setItem(eN,JSON.stringify(e))}catch(e){console.error("Failed to save to localStorage:",e)}},eE=()=>{try{if(!l)return[];let e=localStorage.getItem(eN);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load from localStorage:",e),[]}};(0,f.useEffect)(()=>{if(l&&u){let e=eE();e.length>0&&(h(e),N(Math.max(...e.map(e=>e.index))+1))}},[l,u]);let eS=async(e,t)=>{if(i){console.log("[v0] Fetching balance for address ".concat(e," at index ").concat(t)),T(e=>new Set(e).add(t));try{let n=i.provider,a=await n.getBalance(e),r=(0,Z.dF)(a);console.log("[v0] Balance fetched: ".concat(r," ETH for address ").concat(e)),h(e=>e.map(e=>e.index===t?{...e,balance:r}:e));let s=p.map(e=>e.index===t?{...e,balance:r}:e);if(ej(s),Number.parseFloat(r)>0){console.log("[v0] Balance > 0, checking nullifier consumption for index ".concat(t));let e=p.find(e=>e.index===t);e?(console.log("[v0] Found result for index ".concat(t,", burn key: ").concat(e.burnKey)),await eB(e.burnKey,t)):console.log("[v0] No result found for index ".concat(t))}}catch(e){console.error("Failed to fetch balance:",e)}finally{T(e=>{let n=new Set(e);return n.delete(t),n})}}};function eC(e,t){let n=e.toString(16).padStart(2*t,"0"),a=new Uint8Array(t);for(let e=0;e<t;e++)a[e]=Number.parseInt(n.substr(2*e,2),16);return a}async function ek(){if(!i)throw Error("Wallet not connected");if(null!==A)return A;let e=await i.signMessage("EIP-7503"),t=BigInt(ed.P.from(e).s)%eg;return F(t),t}let eB=async(e,t)=>{if(!(null==i?void 0:i.provider)){console.log("[v0] No signer or provider available for nullifier check");return}console.log("[v0] Checking nullifier consumption for burn key ".concat(e," at index ").concat(t)),h(e=>e.map(e=>e.index===t?{...e,checkingConsumption:!0}:e));try{let n=c.contracts.beth;if(!n){console.warn("[v0] BETH contract address not configured");return}console.log("[v0] Using BETH contract address: ".concat(n));let a=function(e){let t=BigInt(e);return BigInt((0,eu.h4)(["0x"+eh.toString(16),"0x"+t.toString(16)]))}(e),r=function(e){let t=new Uint8Array(32),n=new Uint8Array(32),a=e.toString(16).padStart(64,"0");for(let e=0;e<32;e++)t[e]=Number.parseInt(a.substr(2*e,2),16);n[31]=7;let r=new Uint8Array(64);return r.set(t,0),r.set(n,32),console.log(r),(0,em.w)(r)}(a);console.log("[v0] Nullifier: ".concat(a.toString())),console.log("[v0] Storage slot: ".concat(r));let s=await i.provider.getStorage(n,r);console.log(r);let o="0x0000000000000000000000000000000000000000000000000000000000000001"===s;console.log("[v0] Storage value: ".concat(s)),console.log("[v0] Is consumed: ".concat(o)),h(e=>{let n=e.map(e=>e.index===t?{...e,isConsumed:o,checkingConsumption:!1}:e);return ej(n),n})}catch(e){console.error("[v0] Error checking nullifier consumption:",e),h(e=>e.map(e=>e.index===t?{...e,checkingConsumption:!1}:e))}};async function eA(e){v(!0),E(null);try{if(!i||!l)throw Error("Please connect your wallet first");let t=BigInt(0),n=function(e){let t=e.startsWith("0x")?e.slice(2):e,n=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2)n[e/2]=Number.parseInt(t.substr(e,2),16);return n}(l),a=eC(t,32),r=new TextEncoder().encode("EIP-7503"),s=(await ek()+BigInt(e)*BigInt(10)**BigInt(18))%eg,o=0;for(;o<1e8;){s>=eg&&(s=BigInt(0));let i=eC(s,32),c=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let a=new Uint8Array(t.reduce((e,t)=>e+t.length,0)),r=0;for(let e of t)a.set(e,r),r+=e.length;return a}(i,n,a,r),d="0x"+Array.from(c).map(e=>e.toString(16).padStart(2,"0")).join("");if((0,em.w)(d).slice(2).slice(0,4)==="0".repeat(4)){let n=function(e,t,n){try{let a=BigInt(t),r="0x"+ep.toString(16),s="0x"+e.toString(16),o="0x"+a.toString(16),l="0x"+n.toString(16),i=(0,eu.qw)([r,s,o,l]),c=eC(BigInt(i),32).slice(0,20);return"0x"+Array.from(c).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(e){throw console.error("Error deriving burn address:",e),Error("Failed to derive burn address")}}(s,l,t),a={index:e,burnKey:s.toString(),burnAddress:n};h(t=>{let n=[...t.filter(t=>t.index!==e),a].sort((e,t)=>e.index-t.index);return ej(n),n}),setTimeout(()=>eS(n,e),100);return}s+=BigInt(1),++o%1e3==0&&await new Promise(e=>setTimeout(e,0))}throw Error("Could not find suitable burn key within ".concat(1e8," iterations for index ").concat(e))}catch(e){E(e instanceof Error?e.message:"An error occurred")}finally{v(!1)}}let eF=e=>{let t=p.find(t=>t.burnAddress===e),n=(null==t?void 0:t.balance)?Number.parseFloat(t.balance):0;H(e),Y((null==t?void 0:t.burnKey)||""),K(n>0),X({stage:"confirm"}),R(!0),W(""),C(null),B(null)},e_=async()=>{if(i&&U&&M){J(!0);try{let e=(0,Z.fi)(U),t=await i.sendTransaction({to:M,value:e});await t.wait();let n=p.find(e=>e.burnAddress===M);n&&setTimeout(()=>eS(M,n.index),1e3),R(!1),W(""),null==s||s()}catch(e){E(e instanceof Error?e.message:"Failed to burn ETH")}finally{J(!1)}}},eT=async()=>{X({stage:"generate"}),C(null),B(null);let e=p.find(e=>e.burnAddress===M),t=(null==e?void 0:e.balance)||"0",n="sepolia";try{if(null==i?void 0:i.provider){let e=await i.provider.getNetwork().then(e=>e.chainId);console.log("[v0] Chain ID:",e),(31337n===e||1337n===e)&&(n="anvil")}}catch(e){console.error("[v0] Error detecting network:",e)}let a={amount:t,fee:"0",spend:t,network:n,wallet_address:l,burn_key:V},r=eb?ef:ea;console.log("[v0] Generating proof with endpoint: ".concat(r)),console.log("[v0] Generating proof with request:",JSON.stringify(a,null,2));try{var s;let e=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},mode:"cors",body:JSON.stringify(a)});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();if(console.log("[v0] Job response:",JSON.stringify(t,null,2)),null===(s=t.result)||void 0===s?void 0:s.job_id){let e=t.result.job_id,n="".concat(r,"/").concat(e);console.log("[v0] Starting to poll: ".concat(n));let a=async()=>{try{let e=await fetch(n,{method:"GET",headers:{Accept:"application/json"},mode:"cors"});if(e.ok){let t=await e.json();if(console.log("[v0] Poll response:",JSON.stringify(t,null,2)),"error"===t.status||"failed"===t.status){let e=t.message||t.error||"Unknown error";console.error("[v0] Job failed:",e),B(e),C("Proof generation failed: ".concat(e)),X({stage:"confirm"});return}if("in_progress"===t.status||"pending"===t.status){console.log("[v0] Job in progress, continuing to poll..."),t.message&&B(t.message),setTimeout(a,5e3);return}if("completed"===t.status){console.log("[v0] Job completed, proof ready!"),X({stage:"submit",proof:t.result}),B(null);return}console.log("[v0] Unknown status, continuing to poll..."),setTimeout(a,5e3)}else console.error("[v0] Poll request failed:",e.status),setTimeout(a,5e3)}catch(e){console.error("[v0] Polling error:",e),setTimeout(a,5e3)}};a()}else console.error("[v0] No job_id received in response"),C("Invalid response from proof endpoint - no job_id received"),X({stage:"confirm"})}catch(e){console.error("[v0] Error calling proof endpoint:",e),C("Failed to request proof: ".concat(e instanceof Error?e.message:"Unknown error")),X({stage:"confirm"})}},eI=async()=>{if(X({stage:"submitting"}),C(null),console.log("[v0] Submitting proof:",JSON.stringify(Q.proof,null,2)),!i||!Q.proof){C("Missing signer or proof data");return}try{let{proof:e,block_number:t,nullifier_u256:n,remaining_coin:a,fee:r,spend:s,wallet_address:o}=Q.proof,l=[e.proof.pi_a[0],e.proof.pi_a[1]],d=[[e.proof.pi_b[0][1],e.proof.pi_b[0][0]],[e.proof.pi_b[1][1],e.proof.pi_b[1][0]]],m=[e.proof.pi_c[0],e.proof.pi_c[1]],u=BigInt(t),g=BigInt(n),p=BigInt(a),h=BigInt(r),f=BigInt(s);console.log("[v0] Calling mintCoin with parameters:",{_pA:l,_pB:d,_pC:m,_blockNumber:u.toString(),_nullifier:g.toString(),_remainingCoin:p.toString(),_fee:h.toString(),_spend:f.toString(),_receiver:o});let x=c.contracts.beth;if(!x)throw Error("BETH contract address not configured for current network");let b=new z.CH(x,[{name:"mintCoin",type:"function",stateMutability:"nonpayable",inputs:[{name:"_pA",type:"uint256[2]"},{name:"_pB",type:"uint256[2][2]"},{name:"_pC",type:"uint256[2]"},{name:"_blockNumber",type:"uint256"},{name:"_nullifier",type:"uint256"},{name:"_remainingCoin",type:"uint256"},{name:"_fee",type:"uint256"},{name:"_spend",type:"uint256"},{name:"_receiver",type:"address"}],outputs:[]}],i),v=await b.mintCoin(l,d,m,u,g,p,h,f,o);console.log("[v0] mintCoin transaction sent:",v.hash),await v.wait(),console.log("[v0] mintCoin transaction confirmed"),X({stage:"complete"}),console.log("[v0] Proof submitted successfully, refreshing balances..."),setTimeout(()=>{eR()},1e3),setTimeout(()=>{R(!1),X({stage:"confirm"})},2e3)}catch(e){console.error("[v0] Error submitting proof:",e),C("Failed to submit proof: ".concat(e instanceof Error?e.message:"Unknown error")),X({stage:"submit"})}},eR=()=>{p.forEach(e=>{eS(e.burnAddress,e.index)})},eM=ey?p:p.filter(e=>!e.isConsumed||!e.balance||0===Number.parseFloat(e.balance));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(P.Vq,{open:u,onOpenChange:g,children:[(0,a.jsx)(P.hg,{asChild:!0,children:r}),(0,a.jsxs)(P.cZ,{className:"bg-green-950/95 border-green-800 text-white max-w-4xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)(P.fK,{children:[(0,a.jsxs)(P.$N,{className:"text-2xl text-green-300 flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-6 h-6"}),"Burn Addresses"]}),(0,a.jsx)(P.Be,{className:"text-gray-400",children:"Manage your burn addresses for EIP-7503 transactions. Generate new addresses or use existing ones to burn ETH."})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)(o.z,{onClick:eR,size:"sm",variant:"outline",className:"border-green-600 text-green-300 hover:bg-green-900/50 bg-transparent",disabled:_.size>0,children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 mr-2 ".concat(_.size>0?"animate-spin":"")}),"Refresh Balances"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"showConsumed",checked:ey,onChange:e=>ew(e.target.checked),className:"rounded border-green-700 bg-green-950/60 text-green-600 focus:ring-green-600"}),(0,a.jsx)(q,{htmlFor:"showConsumed",className:"text-white text-sm",children:"Show consumed burn-addresses"})]})]}),(0,a.jsx)(o.z,{onClick:()=>{eA(y),N(e=>e+1)},disabled:x||!l,size:"sm",className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-black font-semibold",children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(el.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating #",y,"..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ei.Z,{className:"mr-2 h-4 w-4"}),"Generate Address #",y]})})]}),eM.length>0?(0,a.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:eM.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-green-950/40 border border-green-800 rounded-lg",children:[(0,a.jsxs)("span",{className:"text-sm font-medium min-w-[60px] text-green-300",children:["#",e.index]}),(0,a.jsx)("span",{className:"text-xs text-gray-300 flex-1 font-mono bg-black/30 px-2 py-1 rounded",children:e.burnAddress}),(0,a.jsxs)("span",{className:"text-xs text-gray-400 min-w-[120px]",children:["Balance:"," ",_.has(e.index)?(0,a.jsx)(el.Z,{className:"h-3 w-3 animate-spin inline text-green-400"}):e.balance?(0,a.jsxs)("span",{className:"text-green-300 font-medium",children:[Number.parseFloat(e.balance).toFixed(6)," ETH"]}):"Unknown"]}),(0,a.jsx)(o.z,{size:"sm",variant:"outline",onClick:()=>eF(e.burnAddress),disabled:e.balance&&Number.parseFloat(e.balance)>0&&e.isConsumed,className:"ml-2 border-green-600 text-green-300 hover:bg-green-900/50 bg-transparent ".concat(e.isConsumed?"opacity-50 cursor-not-allowed":""),children:e.balance&&Number.parseFloat(e.balance)>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ec.Z,{className:"h-3 w-3 mr-1 text-green-400"}),e.isConsumed?"Consumed":"Mint"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{className:"h-3 w-3 mr-1 text-yellow-400"}),"Burn"]})})]},e.index))}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,a.jsx)(m.Z,{className:"w-12 h-12 mx-auto mb-4 text-green-600"}),0===p.length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"No burn addresses generated yet."}),(0,a.jsx)("p",{className:"text-sm",children:'Click "Generate Address" to create your first burn address.'})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"No available burn addresses to show."}),(0,a.jsx)("p",{className:"text-sm",children:'Check "Show consumed burn-addresses" to see all addresses.'})]})]}),j&&(0,a.jsx)($,{className:"bg-red-900/30 border-red-700",children:(0,a.jsx)(D,{className:"text-red-300",children:j})})]})]})]}),(0,a.jsx)(P.Vq,{open:I,onOpenChange:R,children:(0,a.jsxs)(P.cZ,{className:"bg-green-950/95 border-green-800 text-white",children:[(0,a.jsxs)(P.fK,{children:[(0,a.jsx)(P.$N,{className:"text-green-300",children:L?"Mint BETH":"Burn ETH"}),(0,a.jsx)(P.Be,{className:"text-gray-400",children:L?(0,a.jsxs)(a.Fragment,{children:["confirm"===Q.stage&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("strong",{children:[(null===(t=p.find(e=>e.burnAddress===M))||void 0===t?void 0:t.balance)||"0"," BETH"]})," ","is going to be minted for address ",(0,a.jsx)("strong",{children:l})]}),"generate"===Q.stage&&(k||"Generating cryptographic proof..."),"submit"===Q.stage&&"Proof generated successfully. Ready to submit.","complete"===Q.stage&&"BETH minted successfully!"]}):"Send ETH to the burn address: ".concat(M)})]}),L?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)($,{className:"bg-yellow-900/30 border-yellow-600",children:(0,a.jsxs)(D,{className:"text-yellow-200",children:[(0,a.jsx)("strong",{children:"Privacy Notice:"})," If you want to use the privacy aspects of this protocol, it's mandatory to broadcast the proof submission transaction through a different wallet. If you just want to get BETH for WORM mining, using the same wallet is okay."]})}),S&&(0,a.jsx)($,{className:"bg-red-900/30 border-red-700",children:(0,a.jsx)(D,{className:"text-red-300",children:S})}),"generate"===Q.stage&&k&&(0,a.jsx)("div",{className:"p-4 border-2 rounded-lg shadow-lg ".concat(S?"bg-gradient-to-r from-red-900/40 to-red-800/40 border-red-500/50":"bg-gradient-to-r from-blue-900/40 to-purple-900/40 border-blue-500/50"),children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:S?(0,a.jsx)("div",{className:"h-5 w-5 rounded-full bg-red-500 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white text-xs font-bold",children:"!"})}):(0,a.jsx)(el.Z,{className:"h-5 w-5 animate-spin text-blue-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium mb-1 ".concat(S?"text-red-200":"text-blue-200"),children:S?"Proof Generation Error":"Proof Generation Status"}),(0,a.jsx)("p",{className:"text-white font-semibold",children:k})]})]})}),(0,a.jsxs)("div",{className:"p-4 bg-green-950/40 border border-green-800 rounded-lg",children:[(0,a.jsxs)("p",{className:"text-sm text-white",children:[(0,a.jsx)("strong",{children:"Burn Address:"})," ",(0,a.jsx)("span",{className:"font-mono text-xs",children:M})]}),(0,a.jsxs)("p",{className:"text-sm text-white",children:[(0,a.jsx)("strong",{children:"Available Balance:"})," ",(0,a.jsxs)("span",{className:"text-green-300 font-medium",children:[(null===(n=p.find(e=>e.burnAddress===M))||void 0===n?void 0:n.balance)||"0"," ETH"]})]})]}),"confirm"===Q.stage&&(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(q,{htmlFor:"endpoint",className:"text-white",children:"Proving Endpoint"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"useCustomEndpoint",checked:eb,onChange:e=>ev(e.target.checked),className:"rounded border-green-700 bg-green-950/60 text-green-600 focus:ring-green-600"}),(0,a.jsx)(q,{htmlFor:"useCustomEndpoint",className:"text-white text-sm",children:"Use custom endpoint"})]}),eb?(0,a.jsx)(O,{type:"url",placeholder:"https://your-custom-endpoint.com/prove",value:ef,onChange:e=>ex(e.target.value),className:"bg-green-950/60 border-green-700 text-white placeholder:text-gray-400"}):(0,a.jsxs)(ee,{value:ea,onValueChange:er,children:[(0,a.jsx)(en,{className:"bg-green-950/60 border-green-700 text-white",children:(0,a.jsx)(et,{placeholder:"Select proving endpoint"})}),(0,a.jsx)(es,{className:"bg-green-950 border-green-700",children:["https://worm-testnet.metatarz.xyz/proof","https://worm-miner-3.darkube.app/proof","http://localhost:8080/proof"].map(e=>(0,a.jsx)(eo,{value:e,children:e},e))})]})]})}),"submit"===Q.stage&&(0,a.jsx)("div",{className:"p-3 bg-green-950/40 border border-green-800 rounded text-xs",children:(0,a.jsx)("strong",{className:"text-white",children:"Proof Generated!"})}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(o.z,{variant:"outline",onClick:()=>R(!1),className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-800 bg-transparent",children:"Cancel"}),"confirm"===Q.stage&&(0,a.jsx)(o.z,{onClick:eT,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-black font-semibold",children:"Generate proof"}),"generate"===Q.stage&&(0,a.jsxs)(o.z,{disabled:!0,className:"flex-1 bg-gray-600",children:[(0,a.jsx)(el.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating proof..."]}),"submit"===Q.stage&&(0,a.jsx)(o.z,{onClick:eI,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-black font-semibold",children:"Submit proof"}),"submitting"===Q.stage&&(0,a.jsxs)(o.z,{disabled:!0,className:"flex-1 bg-gray-600",children:[(0,a.jsx)(el.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting proof..."]}),"complete"===Q.stage&&(0,a.jsxs)(o.z,{disabled:!0,className:"flex-1 bg-green-600",children:[(0,a.jsx)(ec.Z,{className:"mr-2 h-4 w-4"}),"Minted successfully!"]})]})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(q,{htmlFor:"burnAmount",className:"text-white",children:"Amount (ETH)"}),(0,a.jsx)(O,{id:"burnAmount",type:"number",placeholder:"0.0",value:U,onChange:e=>W(e.target.value),min:"0",max:"1",step:"0.001",className:"bg-green-950/60 border-green-700 text-white placeholder:text-gray-400"}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Maximum: 1 ETH"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(o.z,{variant:"outline",onClick:()=>R(!1),className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-800 bg-transparent",children:"Cancel"}),(0,a.jsx)(o.z,{onClick:e_,disabled:!U||0>=Number.parseFloat(U)||Number.parseFloat(U)>1||G,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-black font-semibold",children:G?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(el.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Burning..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),"Burn ",U," ETH"]})})]})]})]})})]})}function ex(){let{isConnected:e,address:t,connectWallet:n,disconnectWallet:x,error:v}=w(),{bethBalance:y,wormBalance:N,loading:j,error:E}=function(){let{isConnected:e,address:t,provider:n}=w(),{networkConfig:a}=(0,b.L)(),[r,s]=(0,f.useState)("0.0000"),[o,l]=(0,f.useState)("0.0000"),[i,c]=(0,f.useState)(!1),[d,m]=(0,f.useState)(null),[u,g]=(0,f.useState)(null),p=[{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}],h=async()=>{if(!e||!t||!n){s("0.0000"),l("0.0000");return}u&&u.abort();let r=new AbortController;g(r);try{c(!0),m(null),console.log("[v0] Fetching balances for address:",t),console.log("[v0] Using BETH contract:",a.contracts.beth),console.log("[v0] Using WORM contract:",a.contracts.worm);let e=new z.CH(a.contracts.beth,p,n),o=new z.CH(a.contracts.worm,p,n),[i,d]=await Promise.all([n.getCode(a.contracts.beth),n.getCode(a.contracts.worm)]);"0x"===i&&(console.warn("[v0] BETH contract not found at address:",a.contracts.beth),s("0.0000")),"0x"===d&&(console.warn("[v0] WORM contract not found at address:",a.contracts.worm),l("0.0000"));let u=[],g=[];if("0x"!==i&&(u.push(e.balanceOf(t)),g.push("beth")),"0x"!==d&&(u.push(o.balanceOf(t)),g.push("worm")),0===u.length){console.warn("[v0] No valid contracts found on this network"),s("0.0000"),l("0.0000");return}let h=Promise.all(u),f=new Promise((e,t)=>{setTimeout(()=>t(Error("Request timeout")),1e4)}),x=new Promise((e,t)=>{r.signal.addEventListener("abort",()=>{t(Error("Request cancelled"))})}),b=await Promise.race([h,f,x]);if(r.signal.aborted)return;let v=BigInt(0),y=BigInt(0),w=0;g.includes("beth")&&(v=b[w],w++),g.includes("worm")&&(y=b[w]);let N=Z.dF(v),j=Z.dF(y);s(Number.parseFloat(N).toFixed(4)),l(Number.parseFloat(j).toFixed(4)),console.log("[v0] Balances fetched - BETH:",N,"WORM:",j)}catch(e){var o,i;(null===(o=e.message)||void 0===o?void 0:o.includes("network changed"))||"NETWORK_ERROR"===e.code?(console.log("[v0] Network change detected during balance fetch, will retry"),s("0.0000"),l("0.0000")):"Request cancelled"===e.message||"Request timeout"===e.message?console.log("[v0] Balance fetch cancelled or timed out"):("BAD_DATA"===e.code||(null===(i=e.message)||void 0===i?void 0:i.includes("could not decode result data"))?console.warn("[v0] Contract call failed - contracts may not exist on this network:",e.message):(console.error("[v0] Error fetching balances:",e),m(e.message||"Failed to fetch balances")),s("0.0000"),l("0.0000"))}finally{c(!1),g(null)}};return(0,f.useEffect)(()=>{h()},[e,t,n,a]),(0,f.useEffect)(()=>{if(e&&t){let e=setInterval(h,3e4);return()=>clearInterval(e)}},[e,t]),(0,f.useEffect)(()=>()=>{u&&u.abort()},[]),{bethBalance:r,wormBalance:o,loading:i,error:d}}(),{currentEpoch:S}=function(){let[e,t]=(0,f.useState)(0),[n,a]=(0,f.useState)(!0),[r,s]=(0,f.useState)(null),{networkConfig:o}=(0,b.L)(),l=async()=>{try{a(!0),s(null);let e=o.rpcUrls[0];console.log("[v0] Fetching current epoch from:",e),console.log("[v0] Using WORM contract:",o.contracts.worm);let n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:"eth_call",params:[{to:o.contracts.worm,data:"0x76671808"},"latest"],id:1})}),r=await n.json();if(r.error)throw Error(r.error.message);let l=Number.parseInt(r.result,16);t(l),console.log("[v0] Current epoch:",l)}catch(e){console.error("[v0] Error fetching current epoch:",e),s(e instanceof Error?e.message:"Failed to fetch current epoch")}finally{a(!1)}};return(0,f.useEffect)(()=>{l();let e=setInterval(l,3e4);return()=>clearInterval(e)},[o]),{currentEpoch:e,loading:n,error:r,refetch:l}}();return(0,a.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,a.jsxs)("div",{className:"container mx-auto px-6 py-6 flex justify-between items-center",children:[(0,a.jsxs)(h.default,{href:"/",className:"inline-flex items-center gap-2 text-green-300 hover:text-green-200 transition-colors",children:[(0,a.jsx)(l.Z,{className:"w-4 h-4"}),"Back to Home"]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(M,{}),v&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-300 text-sm",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:v})]}),e?(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"text-sm font-mono text-green-300 bg-green-950/60 px-3 py-1 rounded-lg",children:"".concat(t.slice(0,6),"...").concat(t.slice(-4))}),(0,a.jsx)(o.z,{size:"sm",variant:"outline",onClick:x,className:"border-red-600 text-red-300 hover:bg-red-900/50 bg-transparent",children:"Disconnect"})]}):(0,a.jsxs)(o.z,{onClick:n,size:"sm",className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-black font-semibold border-0",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Connect Wallet"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Connect"})]})]})]}),(0,a.jsx)("section",{className:"py-1 bg-green-950/10",children:(0,a.jsx)("div",{className:"container mx-auto px-6",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 transition-opacity duration-300 ".concat(e?"opacity-100":"opacity-50"),children:[(0,a.jsxs)(s.Zb,{className:"bg-green-950/40 border-green-800",children:[(0,a.jsxs)(s.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(s.ll,{className:"text-sm font-medium text-green-300",children:"BETH Balance"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[j&&(0,a.jsx)(d.Z,{className:"h-3 w-3 text-green-400 animate-spin"}),(0,a.jsx)(m.Z,{className:"h-4 w-4 text-yellow-400"})]})]}),(0,a.jsxs)(s.aY,{className:"space-y-3",children:[(0,a.jsx)("div",{className:"text-xl font-bold text-yellow-300 font-mono",children:e?j?"...":y:"---.----"}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"Burned ETH tokens"}),E&&(0,a.jsx)("p",{className:"text-xs text-red-400",children:"Error loading balance"}),(0,a.jsx)(ef,{onBurnComplete:()=>{console.log("[v0] Burn completed, balances will refresh automatically")},children:(0,a.jsxs)(o.z,{size:"sm",variant:"outline",className:"border-green-600 text-green-300 hover:bg-green-900/50 bg-transparent w-full",children:["Burn ETH",(0,a.jsx)(m.Z,{className:"ml-2 w-4 h-4"})]})}),(0,a.jsx)("p",{className:"text-xs text-gray-400 text-center",children:"Max 1 ETH per transaction"})]})]}),(0,a.jsxs)(s.Zb,{className:"bg-green-950/40 border-green-800",children:[(0,a.jsxs)(s.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(s.ll,{className:"text-sm font-medium text-green-300",children:"WORM Balance"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[j&&(0,a.jsx)(d.Z,{className:"h-3 w-3 text-green-400 animate-spin"}),(0,a.jsx)(u.Z,{className:"h-4 w-4 text-green-400"})]})]}),(0,a.jsxs)(s.aY,{className:"space-y-3",children:[(0,a.jsx)("div",{className:"text-xl font-bold text-green-300 font-mono",children:e?j?"...":N:"---.----"}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"Mined WORM tokens"}),E&&(0,a.jsx)("p",{className:"text-xs text-red-400",children:"Error loading balance"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsx)(K,{bethBalance:y,currentEpoch:S,children:(0,a.jsxs)(o.z,{size:"sm",variant:"outline",className:"border-blue-600 text-blue-300 hover:bg-blue-900/50 bg-transparent",disabled:!e,children:[(0,a.jsx)(g.Z,{className:"w-3 h-3 mr-1"}),"Participate"]})}),(0,a.jsx)(V,{currentEpoch:S,children:(0,a.jsxs)(o.z,{size:"sm",variant:"outline",className:"border-purple-600 text-purple-300 hover:bg-purple-900/50 bg-transparent",disabled:!e,children:[(0,a.jsx)(p.Z,{className:"w-3 h-3 mr-1"}),"Claim"]})})]})]})]})]})})})}),(0,a.jsx)(r.BurnActivity,{})]})}function eb(){return(0,a.jsx)(b.NetworkProvider,{children:(0,a.jsx)(y,{children:(0,a.jsx)(ex,{})})})}}},function(e){e.O(0,[658,715,140,971,117,744],function(){return e(e.s=6270)}),_N_E=e.O()}]);