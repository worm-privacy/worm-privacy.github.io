(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[933],{6270:function(e,t,a){Promise.resolve().then(a.bind(a,6582))},6582:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ex}});var n=a(7437),r=a(6900),s=a(6070),o=a(2869),l=a(2660),i=a(9322),c=a(1804),d=a(7168),m=a(6399),u=a(9232),p=a(5805),g=a(7414),h=a(7648),f=a(2265),x=a(7593),b=a(6366);let v=(0,f.createContext)(void 0);function y(e){let{children:t}=e,[a,r]=(0,f.useState)(!1),[s,o]=(0,f.useState)(null),[l,i]=(0,f.useState)(null),[c,d]=(0,f.useState)(null),[m,u]=(0,f.useState)(null),{networkConfig:p,isNetworkSupported:g,getNetworkByChainId:h}=(0,b.L)(),y=async()=>{try{if(u(null),void 0===window.ethereum)throw Error("MetaMask is not installed. Please install MetaMask to continue.");await window.ethereum.request({method:"eth_requestAccounts"});let e=new x.Q(window.ethereum),t=await e.getSigner(),a=await t.getAddress(),n=await e.getNetwork();if("0x".concat(n.chainId.toString(16))!==p.chainId)try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:p.chainId}]})}catch(e){if(4902===e.code){if("Anvil Local"!==p.chainName)await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:p.chainId,chainName:p.chainName,nativeCurrency:p.nativeCurrency,rpcUrls:p.rpcUrls,blockExplorerUrls:p.blockExplorerUrls}]});else throw Error("Please start your local Anvil node and add the network manually")}else throw e}i(e),d(t),o(a),r(!0),console.log("[v0] Wallet connected:",a)}catch(e){console.error("[v0] Wallet connection error:",e),u(e.message||"Failed to connect wallet"),r(!1),o(null),i(null),d(null)}},w=()=>{r(!1),o(null),i(null),d(null),u(null),console.log("[v0] Wallet disconnected")},N=async()=>{if(void 0!==window.ethereum&&a)try{let e=new x.Q(window.ethereum),t=await e.getSigner();i(e),d(t),console.log("[v0] Provider updated for network change")}catch(e){console.error("[v0] Error updating provider:",e)}};return(0,f.useEffect)(()=>{if(void 0!==window.ethereum){let e=e=>{0===e.length?w():e[0]!==s&&y()},t=async e=>{console.log("[v0] Network changed to:",e),h(e)?await N():(u("Unsupported network. Please switch to Sepolia or Anvil."),w())};return window.ethereum.on("accountsChanged",e),window.ethereum.on("chainChanged",t),()=>{window.ethereum.removeListener("accountsChanged",e),window.ethereum.removeListener("chainChanged",t)}}},[s,h,a]),(0,f.useEffect)(()=>{(async()=>{if(void 0!==window.ethereum)try{(await window.ethereum.request({method:"eth_accounts"})).length>0&&await y()}catch(e){console.error("[v0] Error checking wallet connection:",e)}})()},[p]),(0,n.jsx)(v.Provider,{value:{isConnected:a,address:s,provider:l,signer:c,connectWallet:y,disconnectWallet:w,error:m},children:t})}function w(){let e=(0,f.useContext)(v);if(void 0===e)throw Error("useWallet must be used within a WalletProvider");return e}var N=a(3032),j=a(407),E=a(401),S=a(519),C=a(4508);let k=N.fC,B=N.xz;N.ZA,N.Uv,N.Tr,N.Ee,f.forwardRef((e,t)=>{let{className:a,inset:r,children:s,...o}=e;return(0,n.jsxs)(N.fF,{ref:t,className:(0,C.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...o,children:[s,(0,n.jsx)(j.Z,{className:"ml-auto"})]})}).displayName=N.fF.displayName,f.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(N.tu,{ref:t,className:(0,C.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}).displayName=N.tu.displayName;let _=f.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...s}=e;return(0,n.jsx)(N.Uv,{children:(0,n.jsx)(N.VY,{ref:t,sideOffset:r,className:(0,C.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s})})});_.displayName=N.VY.displayName;let A=f.forwardRef((e,t)=>{let{className:a,inset:r,...s}=e;return(0,n.jsx)(N.ck,{ref:t,className:(0,C.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...s})});A.displayName=N.ck.displayName,f.forwardRef((e,t)=>{let{className:a,children:r,checked:s,...o}=e;return(0,n.jsxs)(N.oC,{ref:t,className:(0,C.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:s,...o,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(N.wU,{children:(0,n.jsx)(E.Z,{className:"h-4 w-4"})})}),r]})}).displayName=N.oC.displayName,f.forwardRef((e,t)=>{let{className:a,children:r,...s}=e;return(0,n.jsxs)(N.Rk,{ref:t,className:(0,C.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(N.wU,{children:(0,n.jsx)(S.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=N.Rk.displayName,f.forwardRef((e,t)=>{let{className:a,inset:r,...s}=e;return(0,n.jsx)(N.__,{ref:t,className:(0,C.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...s})}).displayName=N.__.displayName,f.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(N.Z0,{ref:t,className:(0,C.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=N.Z0.displayName;var T=a(9202),F=a(1239),I=a(875);let R={sepolia:{name:"Sepolia",icon:(0,n.jsx)(T.Z,{className:"w-4 h-4"}),color:"text-blue-400"},anvil:{name:"Anvil",icon:(0,n.jsx)(F.Z,{className:"w-4 h-4"}),color:"text-orange-400"}};function M(){let{selectedNetwork:e,switchNetwork:t}=(0,b.L)(),[a,r]=(0,f.useState)(null),s=async a=>{if(a!==e){r(a);try{await t(a)}catch(e){console.error("Failed to switch network:",e)}finally{r(null)}}},l=R[e];return(0,n.jsxs)(k,{children:[(0,n.jsx)(B,{asChild:!0,children:(0,n.jsx)(o.z,{variant:"outline",size:"sm",className:"bg-gray-900/50 border-gray-700 text-gray-300 hover:bg-gray-800/50",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:l.color,children:l.icon}),(0,n.jsx)("span",{className:"hidden sm:inline",children:l.name}),(0,n.jsx)(I.Z,{className:"w-3 h-3"})]})})}),(0,n.jsx)(_,{align:"end",className:"bg-gray-900 border-gray-700",children:Object.entries(R).map(t=>{let[r,o]=t;return(0,n.jsx)(A,{onClick:()=>s(r),disabled:a===r,className:"text-gray-300 hover:bg-gray-800 focus:bg-gray-800",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:o.color,children:o.icon}),(0,n.jsx)("span",{children:o.name}),e===r&&(0,n.jsx)("div",{className:"ml-auto w-2 h-2 bg-green-400 rounded-full"}),a===r&&(0,n.jsx)("div",{className:"ml-auto w-3 h-3 border border-gray-400 border-t-transparent rounded-full animate-spin"})]})},r)})})]})}var Z=a(5810),P=a(1662),z=a(6110);let O=f.forwardRef((e,t)=>{let{className:a,type:r,...s}=e;return(0,n.jsx)("input",{type:r,className:(0,C.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...s})});O.displayName="Input";var H=a(6394),W=a(535);let U=(0,W.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),q=f.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(H.f,{ref:t,className:(0,C.cn)(U(),a),...r})});q.displayName=H.f.displayName;var G=a(3618);function J(){let[e,t]=(0,f.useState)(null),[a,n]=(0,f.useState)(null),[r,s]=(0,f.useState)(null),[o,l]=(0,f.useState)(!1),i=(0,f.useCallback)(async t=>{if(t.length>0){if(e)try{let a=await e.getSigner();n(a),s(t[0]),l(!0)}catch(e){console.error("Failed to get signer:",e)}}else s(null),n(null),l(!1)},[e]);(0,f.useEffect)(()=>{(async()=>{if(window.ethereum){let e=new x.Q(window.ethereum);t(e);try{if((await e.listAccounts()).length>0){let t=await e.getSigner();n(t),s(await t.getAddress()),l(!0)}}catch(e){console.error("Failed to get accounts:",e)}}})()},[]),(0,f.useEffect)(()=>{if(window.ethereum&&i)return window.ethereum.on("accountsChanged",i),()=>{window.ethereum.removeAllListeners("accountsChanged")}},[i]);let c=async()=>{if(e)try{await e.send("eth_requestAccounts",[]);let t=await e.getSigner();n(t),s(await t.getAddress()),l(!0)}catch(e){console.error("Failed to connect:",e)}};return{provider:e,signer:a,address:r,isConnected:o,connect:c}}function L(e,t){let{provider:a,signer:n}=J(),[r,s]=(0,f.useState)(null);(0,f.useEffect)(()=>{a&&e&&t&&s(new Z.CH(e,t,n||a))},[a,n,e]);let o=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!r)return null;try{return await r[e](...t)}catch(t){var a;if((null==t?void 0:t.code)==="NETWORK_ERROR"&&(null==t?void 0:null===(a=t.message)||void 0===a?void 0:a.includes("network changed")))return console.log("[v0] Network changed during ".concat(e," call, ignoring error")),null;return console.error("Error calling ".concat(e,":"),t),null}},l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!r||!n)return null;try{let a;console.log("[v0] Attempting ".concat(e," with args:"),t);let s=await n.provider.getNetwork(),o=31337n===s.chainId||1337n===s.chainId;try{let n=await r[e].estimateGas(...t);console.log("[v0] Estimated gas for ".concat(e,":"),n.toString()),a=o?150n*n/100n:120n*n/100n,console.log("[v0] Using gas limit for ".concat(e,":"),a.toString())}catch(t){console.warn("[v0] Gas estimation failed for ".concat(e,":"),t),a=o?500000n:300000n,console.log("[v0] Using fallback gas limit for ".concat(e,":"),a.toString())}let l=await r[e](...t,{gasLimit:a});return console.log("[v0] ".concat(e," transaction sent:"),l.hash),l}catch(n){var a;if(console.error("[v0] Error calling ".concat(e,":"),n),(null==n?void 0:n.code)===-32603||(null==n?void 0:null===(a=n.message)||void 0===a?void 0:a.includes("Internal JSON-RPC error"))){console.log("[v0] RPC error calling ".concat(e,", trying alternative approach"));try{let a=await r[e](...t,{gasLimit:800000n,type:0});return console.log("[v0] Alternative approach succeeded:",a.hash),a}catch(a){console.error("[v0] Alternative approach also failed for ".concat(e,":"),a);try{console.log("[v0] Trying ".concat(e," with no gas options as final fallback"));let a=await r[e](...t);return console.log("[v0] No-gas-options approach succeeded:",a.hash),a}catch(t){throw console.error("[v0] All approaches failed for ".concat(e,":"),t),t}}}throw n}};return{contract:r,readContract:o,writeContract:l}}function V(e){let{children:t,bethBalance:a,currentEpoch:r}=e,[s,l]=(0,f.useState)(!1),[c,d]=(0,f.useState)(""),[m,u]=(0,f.useState)(""),[p,g]=(0,f.useState)(!1),[h,x]=(0,f.useState)(null),[v,y]=(0,f.useState)(!1),[w,N]=(0,f.useState)(!1),{address:j}=J(),{networkConfig:E}=(0,b.L)(),{readContract:S,writeContract:C}=L(E.contracts.worm,[{name:"approximate",type:"function",stateMutability:"view",inputs:[{name:"_amountPerEpoch",type:"uint256"},{name:"_numEpochs",type:"uint256"}],outputs:[{name:"",type:"uint256"}]},{name:"participate",type:"function",stateMutability:"nonpayable",inputs:[{name:"_amountPerEpoch",type:"uint256"},{name:"_numEpochs",type:"uint256"}],outputs:[]}]),{readContract:k,writeContract:B}=L(E.contracts.beth,[{name:"allowance",type:"function",stateMutability:"view",inputs:[{name:"owner",type:"address"},{name:"spender",type:"address"}],outputs:[{name:"",type:"uint256"}]},{name:"approve",type:"function",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{name:"",type:"bool"}]},{name:"balanceOf",type:"function",stateMutability:"view",inputs:[{name:"account",type:"address"}],outputs:[{name:"",type:"uint256"}]},{name:"name",type:"function",stateMutability:"view",inputs:[],outputs:[{name:"",type:"string"}]},{name:"symbol",type:"function",stateMutability:"view",inputs:[],outputs:[{name:"",type:"string"}]},{name:"decimals",type:"function",stateMutability:"view",inputs:[],outputs:[{name:"",type:"uint8"}]},{name:"totalSupply",type:"function",stateMutability:"view",inputs:[],outputs:[{name:"",type:"uint256"}]}]),_=(Number.parseFloat(c)||0)*(Number.parseFloat(m)||0),A=_<=(Number.parseFloat(a)||0),T=c&&m&&Number.parseFloat(c)>0&&Number.parseFloat(m)>0;(0,f.useEffect)(()=>{let e=new AbortController;return(async()=>{if(c&&m&&Number.parseFloat(c)>0&&Number.parseFloat(m)>0&&j&&E.contracts.worm)try{if(e.signal.aborted)return;console.log("[v0] Calling approximate with:",{amountPerEpoch:Math.floor(1e18*(Number.parseFloat(m)||0)),numEpochs:Number.parseInt(c)||0,contractAddress:E.contracts.worm,userAddress:j});let t=await S("approximate",[BigInt(Math.floor(1e18*(Number.parseFloat(m)||0))),BigInt(Number.parseInt(c)||0)]);if(e.signal.aborted)return;console.log("[v0] Approximate result:",t),x(t)}catch(a){var t;(null==a?void 0:a.code)==="NETWORK_ERROR"&&(null==a?void 0:null===(t=a.message)||void 0===t?void 0:t.includes("network changed"))||console.error("[v0] Error fetching approximate WORM amount:",a),e.signal.aborted||x(null)}else console.log("[v0] Not fetching amount - conditions not met:",{isValid:!!(c&&m&&Number.parseFloat(c)>0&&Number.parseFloat(m)>0),hasAddress:!!j,hasContractAddress:!!E.contracts.worm}),x(null)})(),()=>{e.abort()}},[c,m,j,S,E.contracts.worm]),(0,f.useEffect)(()=>{(async()=>{if(j&&E.contracts.beth&&E.contracts.worm&&_>0)try{let e=await k("allowance",[j,E.contracts.worm]),t=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),a=e>=t/BigInt(2),n=BigInt(Math.floor(1e18*_));y(!a&&e<n)}catch(e){console.error("[v0] Error checking allowance:",e),y(!0)}else y(!1)})()},[j,E.contracts.beth,E.contracts.worm,_,k]);let F=async()=>{if(j&&E.contracts.worm){N(!0);try{let e=BigInt("1000000000000000000000000");console.log("[v0] Approving large BETH spend:",{spender:E.contracts.worm,amount:e.toString()});let t=await B("approve",[E.contracts.worm,e]);console.log("[v0] Approval transaction sent:",t.hash),await t.wait(),console.log("[v0] Approval transaction confirmed"),y(!1)}catch(e){console.error("[v0] Approval error:",e)}finally{N(!1)}}},I=async()=>{if(T&&!v){g(!0);try{console.log("[v0] Participating:",{numEpochs:c,bethPerEpoch:m,totalBeth:_});let e=BigInt(Math.floor(1e18*(Number.parseFloat(m)||0))),t=BigInt(Number.parseInt(c)||0);console.log("[v0] Calling participate with:",{amountPerEpoch:e.toString(),numEpochs:t.toString()});let a=await C("participate",[e,t]);console.log("[v0] Participate transaction sent:",a.hash),await a.wait(),console.log("[v0] Participate transaction confirmed"),l(!1),d(""),u("")}catch(e){console.error("[v0] Participate error:",e)}finally{g(!1)}}};return(0,n.jsxs)(z.Vq,{open:s,onOpenChange:l,children:[(0,n.jsx)(z.hg,{asChild:!0,children:t}),(0,n.jsxs)(z.cZ,{className:"bg-green-950/95 border-green-800 text-white",children:[(0,n.jsx)(z.fK,{children:(0,n.jsx)(z.$N,{className:"text-green-300",children:"Participate in Mining"})}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(q,{htmlFor:"numEpochs",className:"text-green-300",children:"Number of Epochs"}),(0,n.jsx)(O,{id:"numEpochs",type:"number",value:c,onChange:e=>d(e.target.value),className:"bg-green-950/60 border-green-700 text-white",placeholder:"Enter number of epochs"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(q,{htmlFor:"bethPerEpoch",className:"text-green-300",children:"BETH per Epoch"}),(0,n.jsx)(O,{id:"bethPerEpoch",type:"number",step:"0.0001",value:m,onChange:e=>u(e.target.value),className:"bg-green-950/60 border-green-700 text-white",placeholder:"Enter BETH amount per epoch"})]}),(0,n.jsxs)("div",{className:"bg-green-900/30 border border-green-700 rounded-lg p-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,n.jsx)(G.Z,{className:"w-4 h-4 text-green-400"}),(0,n.jsx)("span",{className:"text-green-300 font-medium",children:"Total BETH Required"})]}),(0,n.jsxs)("div",{className:"text-2xl font-mono text-yellow-300",children:[_.toFixed(4)," BETH"]}),(0,n.jsxs)("div",{className:"text-sm text-gray-400",children:["Your Balance: ",a," BETH"]}),!A&&_>0&&(0,n.jsxs)("div",{className:"flex items-center gap-2 mt-2 text-red-400",children:[(0,n.jsx)(i.Z,{className:"w-4 h-4"}),(0,n.jsx)("span",{className:"text-sm",children:"Insufficient BETH balance"})]})]}),c&&m&&Number.parseFloat(c)>0&&Number.parseFloat(m)>0&&(0,n.jsxs)("div",{className:"bg-green-900/30 border border-green-700 rounded-lg p-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,n.jsx)(G.Z,{className:"w-4 h-4 text-green-400"}),(0,n.jsx)("span",{className:"text-green-300 font-medium",children:"Approximate WORM Reward"})]}),(0,n.jsxs)("div",{className:"text-2xl font-mono text-yellow-300",children:[h?(Number(h)/1e18).toFixed(4):"Calculating..."," WORM"]}),(0,n.jsx)("div",{className:"text-sm text-gray-400",children:"Estimated based on current conditions"})]}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)(o.z,{variant:"outline",onClick:()=>l(!1),className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-800",children:"Cancel"}),v?(0,n.jsx)(o.z,{onClick:F,disabled:!T||!A||w,className:"flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-semibold",children:w?"Approving...":"Approve BETH"}):(0,n.jsx)(o.z,{onClick:I,disabled:!T||!A||p,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-black font-semibold",children:p?"Participating...":"Participate"})]})]})]})]})}function K(e){let{children:t,currentEpoch:a}=e,[r,s]=(0,f.useState)(!1),[l,c]=(0,f.useState)(""),[d,m]=(0,f.useState)(""),[u,p]=(0,f.useState)(!1),[g,h]=(0,f.useState)(null),{address:x}=J(),{networkConfig:v}=(0,b.L)(),{readContract:y,writeContract:w}=L(v.contracts.worm,[{name:"calculateMintAmount",type:"function",stateMutability:"view",inputs:[{name:"_startingEpoch",type:"uint256"},{name:"_numEpochs",type:"uint256"},{name:"_user",type:"address"}],outputs:[{name:"",type:"uint256"}]},{name:"claim",type:"function",stateMutability:"nonpayable",inputs:[{name:"_startingEpoch",type:"uint256"},{name:"_numEpochs",type:"uint256"}],outputs:[{name:"",type:"uint256"}]}]),N=Number.parseInt(l)||0,j=Number.parseInt(d)||0,E=N+j-1,S=N<a&&E<a,C=l&&d&&S;(0,f.useEffect)(()=>{(async()=>{if(C&&x&&v.contracts.worm)try{console.log("[v0] Calling calculateMintAmount with:",{startingEpoch:N,numEpochs:j,userAddress:x,contractAddress:v.contracts.worm});let e=await y("calculateMintAmount",[BigInt(N),BigInt(j),x]);console.log("[v0] calculateMintAmount result:",e),h(e)}catch(e){console.error("[v0] Error fetching expected WORM amount:",e),h(null)}else console.log("[v0] Not fetching amount - conditions not met:",{isValid:C,hasAddress:!!x,hasContractAddress:!!v.contracts.worm}),h(null)})()},[C,x,N,j,y,v.contracts.worm]);let k=async()=>{if(C){p(!0);try{console.log("[v0] Claiming:",{fromEpoch:l,numEpochs:d});let e=BigInt(N),t=BigInt(j);console.log("[v0] Calling claim with:",{startingEpoch:e.toString(),numEpochs:t.toString()});let a=await w("claim",[e,t]);console.log("[v0] Claim transaction sent:",a.hash),await a.wait(),console.log("[v0] Claim transaction confirmed"),s(!1),c(""),m("")}catch(e){console.error("[v0] Claim error:",e)}finally{p(!1)}}};return(0,n.jsxs)(z.Vq,{open:r,onOpenChange:s,children:[(0,n.jsx)(z.hg,{asChild:!0,children:t}),(0,n.jsxs)(z.cZ,{className:"bg-green-950/95 border-green-800 text-white",children:[(0,n.jsx)(z.fK,{children:(0,n.jsx)(z.$N,{className:"text-green-300",children:"Claim WORM Tokens"})}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(q,{htmlFor:"claimFromEpoch",className:"text-green-300",children:"From Epoch"}),(0,n.jsx)(O,{id:"claimFromEpoch",type:"number",value:l,onChange:e=>c(e.target.value),className:"bg-green-950/60 border-green-700 text-white",placeholder:"Enter starting epoch",max:a-1})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(q,{htmlFor:"claimNumEpochs",className:"text-green-300",children:"Number of Epochs"}),(0,n.jsx)(O,{id:"claimNumEpochs",type:"number",value:d,onChange:e=>m(e.target.value),className:"bg-green-950/60 border-green-700 text-white",placeholder:"Enter number of epochs to claim"})]}),l&&d&&!S&&(0,n.jsxs)("div",{className:"flex items-center gap-2 text-red-400",children:[(0,n.jsx)(i.Z,{className:"w-4 h-4"}),(0,n.jsxs)("span",{className:"text-sm",children:["Can only claim completed epochs (current: ",a,", claiming: ",N,"-",E,")"]})]}),C&&null!==g&&(0,n.jsxs)("div",{className:"bg-green-900/30 border border-green-700 rounded-lg p-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,n.jsx)(G.Z,{className:"w-4 h-4 text-green-400"}),(0,n.jsx)("span",{className:"text-green-300 font-medium",children:"Expected WORM Reward"})]}),(0,n.jsxs)("div",{className:"text-2xl font-mono text-yellow-300",children:[0n===g?"0.0000":(Number(g)/1e18).toFixed(4)," WORM"]}),(0,n.jsxs)("div",{className:"text-sm text-gray-400",children:["Claimable from epochs ",N," to ",E]}),0n===g&&(0,n.jsx)("div",{className:"text-sm text-orange-400 mt-2",children:"No WORM tokens available for these epochs. You may not have participated in mining during this period."})]}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)(o.z,{variant:"outline",onClick:()=>s(!1),className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-800",children:"Cancel"}),(0,n.jsx)(o.z,{onClick:k,disabled:!C||u,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-black font-semibold",children:u?"Claiming...":"Claim"})]})]})]})]})}let Y=(0,W.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),$=f.forwardRef((e,t)=>{let{className:a,variant:r,...s}=e;return(0,n.jsx)("div",{ref:t,role:"alert",className:(0,C.cn)(Y({variant:r}),a),...s})});$.displayName="Alert",f.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("h5",{ref:t,className:(0,C.cn)("mb-1 font-medium leading-none tracking-tight",a),...r})}).displayName="AlertTitle";let D=f.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,C.cn)("text-sm [&_p]:leading-relaxed",a),...r})});D.displayName="AlertDescription";var Q=a(1264),X=a(2135);let ee=Q.fC;Q.ZA;let et=Q.B4,ea=f.forwardRef((e,t)=>{let{className:a,children:r,...s}=e;return(0,n.jsxs)(Q.xz,{ref:t,className:(0,C.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...s,children:[r,(0,n.jsx)(Q.JO,{asChild:!0,children:(0,n.jsx)(I.Z,{className:"h-4 w-4 opacity-50"})})]})});ea.displayName=Q.xz.displayName;let en=f.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(Q.u_,{ref:t,className:(0,C.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,n.jsx)(X.Z,{className:"h-4 w-4"})})});en.displayName=Q.u_.displayName;let er=f.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(Q.$G,{ref:t,className:(0,C.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,n.jsx)(I.Z,{className:"h-4 w-4"})})});er.displayName=Q.$G.displayName;let es=f.forwardRef((e,t)=>{let{className:a,children:r,position:s="popper",...o}=e;return(0,n.jsx)(Q.h_,{children:(0,n.jsxs)(Q.VY,{ref:t,className:(0,C.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:s,...o,children:[(0,n.jsx)(en,{}),(0,n.jsx)(Q.l_,{className:(0,C.cn)("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,n.jsx)(er,{})]})})});es.displayName=Q.VY.displayName,f.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(Q.__,{ref:t,className:(0,C.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...r})}).displayName=Q.__.displayName;let eo=f.forwardRef((e,t)=>{let{className:a,children:r,...s}=e;return(0,n.jsxs)(Q.ck,{ref:t,className:(0,C.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(Q.wU,{children:(0,n.jsx)(E.Z,{className:"h-4 w-4"})})}),(0,n.jsx)(Q.eT,{children:r})]})});eo.displayName=Q.ck.displayName,f.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(Q.Z0,{ref:t,className:(0,C.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=Q.Z0.displayName;var el=a(1817),ei=a(9397),ec=a(4882),ed=a(5938),em=a(135),eu=a(1489);let ep=BigInt("21888242871839275222246405745257275088548364400416034343698204186575808495617"),eg=BigInt("0xba44186ee7876b8007d2482cd46cec2d115b780980a6b46f0363f983d892f7e");function eh(e){var t,a;let{children:r,onBurnComplete:s}=e,{address:l,signer:i}=w(),{networkConfig:c}=(0,b.L)(),[u,p]=(0,f.useState)(!1),[g,h]=(0,f.useState)([]),[x,v]=(0,f.useState)(!1),[y,N]=(0,f.useState)(0),[j,E]=(0,f.useState)(null),[S,C]=(0,f.useState)(null),[k,B]=(0,f.useState)(null),[_,A]=(0,f.useState)(null),[T,F]=(0,f.useState)(new Set),[I,R]=(0,f.useState)(!1),[M,H]=(0,f.useState)(""),[W,U]=(0,f.useState)(""),[G,J]=(0,f.useState)(!1),[L,V]=(0,f.useState)(!1),[K,Y]=(0,f.useState)(""),[Q,X]=(0,f.useState)({stage:"confirm"}),[en,er]=(0,f.useState)("https://worm-miner-3.darkube.app/proof"),[eh,ef]=(0,f.useState)(""),[ex,eb]=(0,f.useState)(!1),ev="burn-key-results-".concat(l),ey=e=>{try{l&&localStorage.setItem(ev,JSON.stringify(e))}catch(e){console.error("Failed to save to localStorage:",e)}},ew=()=>{try{if(!l)return[];let e=localStorage.getItem(ev);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load from localStorage:",e),[]}};(0,f.useEffect)(()=>{if(l&&u){let e=ew();e.length>0&&(h(e),N(Math.max(...e.map(e=>e.index))+1))}},[l,u]);let eN=async(e,t)=>{if(i){F(e=>new Set(e).add(t));try{let a=i.provider,n=await a.getBalance(e),r=(0,P.dF)(n);h(e=>e.map(e=>e.index===t?{...e,balance:r}:e));let s=g.map(e=>e.index===t?{...e,balance:r}:e);ey(s)}catch(e){console.error("Failed to fetch balance:",e)}finally{F(e=>{let a=new Set(e);return a.delete(t),a})}}};function ej(e,t){let a=e.toString(16).padStart(2*t,"0"),n=new Uint8Array(t);for(let e=0;e<t;e++)n[e]=Number.parseInt(a.substr(2*e,2),16);return n}async function eE(){if(!i)throw Error("Wallet not connected");if(null!==_)return _;let e=await i.signMessage("EIP-7503"),t=BigInt(ed.P.from(e).s)%ep;return A(t),t}async function eS(e){v(!0),E(null);try{if(!i||!l)throw Error("Please connect your wallet first");let t=BigInt(0),a=function(e){let t=e.startsWith("0x")?e.slice(2):e,a=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2)a[e/2]=Number.parseInt(t.substr(e,2),16);return a}(l),n=ej(t,32),r=new TextEncoder().encode("EIP-7503"),s=(await eE()+BigInt(e)*BigInt(10)**BigInt(18))%ep,o=0;for(;o<1e6;){s>=ep&&(s=BigInt(0));let i=ej(s,32),c=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];let n=new Uint8Array(t.reduce((e,t)=>e+t.length,0)),r=0;for(let e of t)n.set(e,r),r+=e.length;return n}(i,a,n,r),d="0x"+Array.from(c).map(e=>e.toString(16).padStart(2,"0")).join("");if((0,em.w)(d).slice(2).slice(0,4)==="0".repeat(4)){let a=function(e,t,a){try{let n=BigInt(t),r="0x"+eg.toString(16),s="0x"+e.toString(16),o="0x"+n.toString(16),l="0x"+a.toString(16),i=(0,eu.qw)([r,s,o,l]),c=ej(BigInt(i),32).slice(0,20);return"0x"+Array.from(c).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(e){throw console.error("Error deriving burn address:",e),Error("Failed to derive burn address")}}(s,l,t),n={index:e,burnKey:s.toString(),burnAddress:a};h(t=>{let a=[...t.filter(t=>t.index!==e),n].sort((e,t)=>e.index-t.index);return ey(a),a}),setTimeout(()=>eN(a,e),100);return}s+=BigInt(1),++o%1e3==0&&await new Promise(e=>setTimeout(e,0))}throw Error("Could not find suitable burn key within ".concat(1e6," iterations for index ").concat(e))}catch(e){E(e instanceof Error?e.message:"An error occurred")}finally{v(!1)}}let eC=e=>{let t=g.find(t=>t.burnAddress===e),a=(null==t?void 0:t.balance)?Number.parseFloat(t.balance):0;H(e),Y((null==t?void 0:t.burnKey)||""),V(a>0),X({stage:"confirm"}),R(!0),U(""),C(null),B(null)},ek=async()=>{if(i&&W&&M){J(!0);try{let e=(0,P.fi)(W),t=await i.sendTransaction({to:M,value:e});await t.wait();let a=g.find(e=>e.burnAddress===M);a&&setTimeout(()=>eN(M,a.index),1e3),R(!1),U(""),null==s||s()}catch(e){E(e instanceof Error?e.message:"Failed to burn ETH")}finally{J(!1)}}},eB=async()=>{X({stage:"generate"}),C(null),B(null);let e=g.find(e=>e.burnAddress===M),t=(null==e?void 0:e.balance)||"0",a="sepolia";try{if(null==i?void 0:i.provider){let e=await i.provider.getNetwork().then(e=>e.chainId);console.log("[v0] Chain ID:",e),(31337n===e||1337n===e)&&(a="anvil")}}catch(e){console.error("[v0] Error detecting network:",e)}let n={amount:t,fee:"0",spend:t,network:a,wallet_address:l,burn_key:K},r=ex?eh:en;console.log("[v0] Generating proof with endpoint: ".concat(r)),console.log("[v0] Generating proof with request:",JSON.stringify(n,null,2));try{var s;let e=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},mode:"cors",body:JSON.stringify(n)});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();if(console.log("[v0] Job response:",JSON.stringify(t,null,2)),null===(s=t.result)||void 0===s?void 0:s.job_id){let e=t.result.job_id,a="".concat(r,"/").concat(e);console.log("[v0] Starting to poll: ".concat(a));let n=async()=>{try{let e=await fetch(a,{method:"GET",headers:{Accept:"application/json"},mode:"cors"});if(e.ok){let t=await e.json();if(console.log("[v0] Poll response:",JSON.stringify(t,null,2)),"error"===t.status||"failed"===t.status){let e=t.message||t.error||"Unknown error";console.error("[v0] Job failed:",e),B(e),C("Proof generation failed: ".concat(e)),X({stage:"confirm"});return}if("in_progress"===t.status||"pending"===t.status){console.log("[v0] Job in progress, continuing to poll..."),t.message&&B(t.message),setTimeout(n,5e3);return}if("completed"===t.status){console.log("[v0] Job completed, proof ready!"),X({stage:"submit",proof:t.result}),B(null);return}console.log("[v0] Unknown status, continuing to poll..."),setTimeout(n,5e3)}else console.error("[v0] Poll request failed:",e.status),setTimeout(n,5e3)}catch(e){console.error("[v0] Polling error:",e),setTimeout(n,5e3)}};n()}else console.error("[v0] No job_id received in response"),C("Invalid response from proof endpoint - no job_id received"),X({stage:"confirm"})}catch(e){console.error("[v0] Error calling proof endpoint:",e),C("Failed to request proof: ".concat(e instanceof Error?e.message:"Unknown error")),X({stage:"confirm"})}},e_=async()=>{if(X({stage:"submitting"}),C(null),console.log("[v0] Submitting proof:",JSON.stringify(Q.proof,null,2)),!i||!Q.proof){C("Missing signer or proof data");return}try{let{proof:e,block_number:t,nullifier_u256:a,remaining_coin:n,fee:r,spend:s,wallet_address:o}=Q.proof,l=[e.proof.pi_a[0],e.proof.pi_a[1]],d=[[e.proof.pi_b[0][1],e.proof.pi_b[0][0]],[e.proof.pi_b[1][1],e.proof.pi_b[1][0]]],m=[e.proof.pi_c[0],e.proof.pi_c[1]],u=BigInt(t),p=BigInt(a),g=BigInt(n),h=BigInt(r),f=BigInt(s);console.log("[v0] Calling mintCoin with parameters:",{_pA:l,_pB:d,_pC:m,_blockNumber:u.toString(),_nullifier:p.toString(),_remainingCoin:g.toString(),_fee:h.toString(),_spend:f.toString(),_receiver:o});let x=c.contracts.beth;if(!x)throw Error("BETH contract address not configured for current network");let b=new Z.CH(x,[{name:"mintCoin",type:"function",stateMutability:"nonpayable",inputs:[{name:"_pA",type:"uint256[2]"},{name:"_pB",type:"uint256[2][2]"},{name:"_pC",type:"uint256[2]"},{name:"_blockNumber",type:"uint256"},{name:"_nullifier",type:"uint256"},{name:"_remainingCoin",type:"uint256"},{name:"_fee",type:"uint256"},{name:"_spend",type:"uint256"},{name:"_receiver",type:"address"}],outputs:[]}],i),v=await b.mintCoin(l,d,m,u,p,g,h,f,o);console.log("[v0] mintCoin transaction sent:",v.hash),await v.wait(),console.log("[v0] mintCoin transaction confirmed"),X({stage:"complete"}),setTimeout(()=>{R(!1),X({stage:"confirm"})},2e3)}catch(e){console.error("[v0] Error submitting proof:",e),C("Failed to submit proof: ".concat(e instanceof Error?e.message:"Unknown error")),X({stage:"submit"})}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(z.Vq,{open:u,onOpenChange:p,children:[(0,n.jsx)(z.hg,{asChild:!0,children:r}),(0,n.jsxs)(z.cZ,{className:"bg-green-950/95 border-green-800 text-white max-w-4xl max-h-[80vh] overflow-y-auto",children:[(0,n.jsxs)(z.fK,{children:[(0,n.jsxs)(z.$N,{className:"text-2xl text-green-300 flex items-center gap-2",children:[(0,n.jsx)(m.Z,{className:"w-6 h-6"}),"Burn Addresses"]}),(0,n.jsx)(z.Be,{className:"text-gray-400",children:"Manage your burn addresses for EIP-7503 transactions. Generate new addresses or use existing ones to burn ETH."})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)(o.z,{onClick:()=>{g.forEach(e=>{eN(e.burnAddress,e.index)})},size:"sm",variant:"outline",className:"border-green-600 text-green-300 hover:bg-green-900/50 bg-transparent",disabled:T.size>0,children:[(0,n.jsx)(d.Z,{className:"w-4 h-4 mr-2 ".concat(T.size>0?"animate-spin":"")}),"Refresh Balances"]}),(0,n.jsx)(o.z,{onClick:()=>{eS(y),N(e=>e+1)},disabled:x||!l,size:"sm",className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-black font-semibold",children:x?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(el.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating #",y,"..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ei.Z,{className:"mr-2 h-4 w-4"}),"Generate Address #",y]})})]}),g.length>0?(0,n.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:g.map(e=>(0,n.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-green-950/40 border border-green-800 rounded-lg",children:[(0,n.jsxs)("span",{className:"text-sm font-medium min-w-[60px] text-green-300",children:["#",e.index]}),(0,n.jsx)("span",{className:"text-xs text-gray-300 flex-1 font-mono bg-black/30 px-2 py-1 rounded",children:e.burnAddress}),(0,n.jsxs)("span",{className:"text-xs text-gray-400 min-w-[120px]",children:["Balance:"," ",T.has(e.index)?(0,n.jsx)(el.Z,{className:"h-3 w-3 animate-spin inline text-green-400"}):e.balance?(0,n.jsxs)("span",{className:"text-green-300 font-medium",children:[Number.parseFloat(e.balance).toFixed(6)," ETH"]}):"Unknown"]}),(0,n.jsx)(o.z,{size:"sm",variant:"outline",onClick:()=>eC(e.burnAddress),className:"ml-2 border-green-600 text-green-300 hover:bg-green-900/50 bg-transparent",children:e.balance&&Number.parseFloat(e.balance)>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ec.Z,{className:"h-3 w-3 mr-1 text-green-400"}),"Mint"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.Z,{className:"h-3 w-3 mr-1 text-yellow-400"}),"Burn"]})})]},e.index))}):(0,n.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,n.jsx)(m.Z,{className:"w-12 h-12 mx-auto mb-4 text-green-600"}),(0,n.jsx)("p",{children:"No burn addresses generated yet."}),(0,n.jsx)("p",{className:"text-sm",children:'Click "Generate Address" to create your first burn address.'})]}),j&&(0,n.jsx)($,{className:"bg-red-900/30 border-red-700",children:(0,n.jsx)(D,{className:"text-red-300",children:j})})]})]})]}),(0,n.jsx)(z.Vq,{open:I,onOpenChange:R,children:(0,n.jsxs)(z.cZ,{className:"bg-green-950/95 border-green-800 text-white",children:[(0,n.jsxs)(z.fK,{children:[(0,n.jsx)(z.$N,{className:"text-green-300",children:L?"Mint BETH":"Burn ETH"}),(0,n.jsx)(z.Be,{className:"text-gray-400",children:L?(0,n.jsxs)(n.Fragment,{children:["confirm"===Q.stage&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("strong",{children:[(null===(t=g.find(e=>e.burnAddress===M))||void 0===t?void 0:t.balance)||"0"," BETH"]})," ","is going to be minted for address ",(0,n.jsx)("strong",{children:l})]}),"generate"===Q.stage&&(k||"Generating cryptographic proof..."),"submit"===Q.stage&&"Proof generated successfully. Ready to submit.","complete"===Q.stage&&"BETH minted successfully!"]}):"Send ETH to the burn address: ".concat(M)})]}),L?(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)($,{className:"bg-yellow-900/30 border-yellow-600",children:(0,n.jsxs)(D,{className:"text-yellow-200",children:[(0,n.jsx)("strong",{children:"Privacy Notice:"})," If you want to use the privacy aspects of this protocol, it's mandatory to broadcast the proof submission transaction through a different wallet. If you just want to get BETH for WORM mining, using the same wallet is okay."]})}),S&&(0,n.jsx)($,{className:"bg-red-900/30 border-red-700",children:(0,n.jsx)(D,{className:"text-red-300",children:S})}),"generate"===Q.stage&&k&&(0,n.jsx)("div",{className:"p-4 border-2 rounded-lg shadow-lg ".concat(S?"bg-gradient-to-r from-red-900/40 to-red-800/40 border-red-500/50":"bg-gradient-to-r from-blue-900/40 to-purple-900/40 border-blue-500/50"),children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:S?(0,n.jsx)("div",{className:"h-5 w-5 rounded-full bg-red-500 flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-white text-xs font-bold",children:"!"})}):(0,n.jsx)(el.Z,{className:"h-5 w-5 animate-spin text-blue-400"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium mb-1 ".concat(S?"text-red-200":"text-blue-200"),children:S?"Proof Generation Error":"Proof Generation Status"}),(0,n.jsx)("p",{className:"text-white font-semibold",children:k})]})]})}),(0,n.jsxs)("div",{className:"p-4 bg-green-950/40 border border-green-800 rounded-lg",children:[(0,n.jsxs)("p",{className:"text-sm text-white",children:[(0,n.jsx)("strong",{children:"Burn Address:"})," ",(0,n.jsx)("span",{className:"font-mono text-xs",children:M})]}),(0,n.jsxs)("p",{className:"text-sm text-white",children:[(0,n.jsx)("strong",{children:"Available Balance:"})," ",(0,n.jsxs)("span",{className:"text-green-300 font-medium",children:[(null===(a=g.find(e=>e.burnAddress===M))||void 0===a?void 0:a.balance)||"0"," ETH"]})]})]}),"confirm"===Q.stage&&(0,n.jsx)("div",{className:"space-y-4",children:(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(q,{htmlFor:"endpoint",className:"text-white",children:"Proving Endpoint"}),(0,n.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,n.jsx)("input",{type:"checkbox",id:"useCustomEndpoint",checked:ex,onChange:e=>eb(e.target.checked),className:"rounded border-green-700 bg-green-950/60 text-green-600 focus:ring-green-600"}),(0,n.jsx)(q,{htmlFor:"useCustomEndpoint",className:"text-white text-sm",children:"Use custom endpoint"})]}),ex?(0,n.jsx)(O,{type:"url",placeholder:"https://your-custom-endpoint.com/prove",value:eh,onChange:e=>ef(e.target.value),className:"bg-green-950/60 border-green-700 text-white placeholder:text-gray-400"}):(0,n.jsxs)(ee,{value:en,onValueChange:er,children:[(0,n.jsx)(ea,{className:"bg-green-950/60 border-green-700 text-white",children:(0,n.jsx)(et,{placeholder:"Select proving endpoint"})}),(0,n.jsx)(es,{className:"bg-green-950 border-green-700",children:["https://worm-miner-3.darkube.app/proof","http://localhost:8080/proof"].map(e=>(0,n.jsx)(eo,{value:e,children:e},e))})]})]})}),"submit"===Q.stage&&(0,n.jsx)("div",{className:"p-3 bg-green-950/40 border border-green-800 rounded text-xs",children:(0,n.jsx)("strong",{className:"text-white",children:"Proof Generated!"})}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)(o.z,{variant:"outline",onClick:()=>R(!1),className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-800 bg-transparent",children:"Cancel"}),"confirm"===Q.stage&&(0,n.jsx)(o.z,{onClick:eB,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-black font-semibold",children:"Generate proof"}),"generate"===Q.stage&&(0,n.jsxs)(o.z,{disabled:!0,className:"flex-1 bg-gray-600",children:[(0,n.jsx)(el.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating proof..."]}),"submit"===Q.stage&&(0,n.jsx)(o.z,{onClick:e_,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-black font-semibold",children:"Submit proof"}),"submitting"===Q.stage&&(0,n.jsxs)(o.z,{disabled:!0,className:"flex-1 bg-gray-600",children:[(0,n.jsx)(el.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting proof..."]}),"complete"===Q.stage&&(0,n.jsxs)(o.z,{disabled:!0,className:"flex-1 bg-green-600",children:[(0,n.jsx)(ec.Z,{className:"mr-2 h-4 w-4"}),"Minted successfully!"]})]})]}):(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(q,{htmlFor:"burnAmount",className:"text-white",children:"Amount (ETH)"}),(0,n.jsx)(O,{id:"burnAmount",type:"number",placeholder:"0.0",value:W,onChange:e=>U(e.target.value),min:"0",max:"1",step:"0.001",className:"bg-green-950/60 border-green-700 text-white placeholder:text-gray-400"}),(0,n.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Maximum: 1 ETH"})]}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)(o.z,{variant:"outline",onClick:()=>R(!1),className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-800 bg-transparent",children:"Cancel"}),(0,n.jsx)(o.z,{onClick:ek,disabled:!W||0>=Number.parseFloat(W)||Number.parseFloat(W)>1||G,className:"flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-black font-semibold",children:G?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(el.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Burning..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),"Burn ",W," ETH"]})})]})]})]})})]})}function ef(){let{isConnected:e,address:t,connectWallet:a,disconnectWallet:x,error:v}=w(),{bethBalance:y,wormBalance:N,loading:j,error:E}=function(){let{isConnected:e,address:t,provider:a}=w(),{networkConfig:n}=(0,b.L)(),[r,s]=(0,f.useState)("0.0000"),[o,l]=(0,f.useState)("0.0000"),[i,c]=(0,f.useState)(!1),[d,m]=(0,f.useState)(null),[u,p]=(0,f.useState)(null),g=[{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}],h=async()=>{if(!e||!t||!a){s("0.0000"),l("0.0000");return}u&&u.abort();let r=new AbortController;p(r);try{c(!0),m(null),console.log("[v0] Fetching balances for address:",t),console.log("[v0] Using BETH contract:",n.contracts.beth),console.log("[v0] Using WORM contract:",n.contracts.worm);let e=new Z.CH(n.contracts.beth,g,a),o=new Z.CH(n.contracts.worm,g,a),[i,d]=await Promise.all([a.getCode(n.contracts.beth),a.getCode(n.contracts.worm)]);"0x"===i&&(console.warn("[v0] BETH contract not found at address:",n.contracts.beth),s("0.0000")),"0x"===d&&(console.warn("[v0] WORM contract not found at address:",n.contracts.worm),l("0.0000"));let u=[],p=[];if("0x"!==i&&(u.push(e.balanceOf(t)),p.push("beth")),"0x"!==d&&(u.push(o.balanceOf(t)),p.push("worm")),0===u.length){console.warn("[v0] No valid contracts found on this network"),s("0.0000"),l("0.0000");return}let h=Promise.all(u),f=new Promise((e,t)=>{setTimeout(()=>t(Error("Request timeout")),1e4)}),x=new Promise((e,t)=>{r.signal.addEventListener("abort",()=>{t(Error("Request cancelled"))})}),b=await Promise.race([h,f,x]);if(r.signal.aborted)return;let v=BigInt(0),y=BigInt(0),w=0;p.includes("beth")&&(v=b[w],w++),p.includes("worm")&&(y=b[w]);let N=P.dF(v),j=P.dF(y);s(Number.parseFloat(N).toFixed(4)),l(Number.parseFloat(j).toFixed(4)),console.log("[v0] Balances fetched - BETH:",N,"WORM:",j)}catch(e){var o,i;(null===(o=e.message)||void 0===o?void 0:o.includes("network changed"))||"NETWORK_ERROR"===e.code?(console.log("[v0] Network change detected during balance fetch, will retry"),s("0.0000"),l("0.0000")):"Request cancelled"===e.message||"Request timeout"===e.message?console.log("[v0] Balance fetch cancelled or timed out"):("BAD_DATA"===e.code||(null===(i=e.message)||void 0===i?void 0:i.includes("could not decode result data"))?console.warn("[v0] Contract call failed - contracts may not exist on this network:",e.message):(console.error("[v0] Error fetching balances:",e),m(e.message||"Failed to fetch balances")),s("0.0000"),l("0.0000"))}finally{c(!1),p(null)}};return(0,f.useEffect)(()=>{h()},[e,t,a,n]),(0,f.useEffect)(()=>{if(e&&t){let e=setInterval(h,3e4);return()=>clearInterval(e)}},[e,t]),(0,f.useEffect)(()=>()=>{u&&u.abort()},[]),{bethBalance:r,wormBalance:o,loading:i,error:d}}(),{currentEpoch:S}=function(){let[e,t]=(0,f.useState)(0),[a,n]=(0,f.useState)(!0),[r,s]=(0,f.useState)(null),{networkConfig:o}=(0,b.L)(),l=async()=>{try{n(!0),s(null);let e=o.rpcUrls[0];console.log("[v0] Fetching current epoch from:",e),console.log("[v0] Using WORM contract:",o.contracts.worm);let a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:"eth_call",params:[{to:o.contracts.worm,data:"0x76671808"},"latest"],id:1})}),r=await a.json();if(r.error)throw Error(r.error.message);let l=Number.parseInt(r.result,16);t(l),console.log("[v0] Current epoch:",l)}catch(e){console.error("[v0] Error fetching current epoch:",e),s(e instanceof Error?e.message:"Failed to fetch current epoch")}finally{n(!1)}};return(0,f.useEffect)(()=>{l();let e=setInterval(l,3e4);return()=>clearInterval(e)},[o]),{currentEpoch:e,loading:a,error:r,refetch:l}}();return(0,n.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,n.jsxs)("div",{className:"container mx-auto px-6 py-6 flex justify-between items-center",children:[(0,n.jsxs)(h.default,{href:"/",className:"inline-flex items-center gap-2 text-green-300 hover:text-green-200 transition-colors",children:[(0,n.jsx)(l.Z,{className:"w-4 h-4"}),"Back to Home"]}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)(M,{}),v&&(0,n.jsxs)("div",{className:"flex items-center gap-2 text-red-300 text-sm",children:[(0,n.jsx)(i.Z,{className:"w-4 h-4"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:v})]}),e?(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"text-sm font-mono text-green-300 bg-green-950/60 px-3 py-1 rounded-lg",children:"".concat(t.slice(0,6),"...").concat(t.slice(-4))}),(0,n.jsx)(o.z,{size:"sm",variant:"outline",onClick:x,className:"border-red-600 text-red-300 hover:bg-red-900/50 bg-transparent",children:"Disconnect"})]}):(0,n.jsxs)(o.z,{onClick:a,size:"sm",className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-black font-semibold border-0",children:[(0,n.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Connect Wallet"}),(0,n.jsx)("span",{className:"sm:hidden",children:"Connect"})]})]})]}),(0,n.jsx)("section",{className:"py-1 bg-green-950/10",children:(0,n.jsx)("div",{className:"container mx-auto px-6",children:(0,n.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 transition-opacity duration-300 ".concat(e?"opacity-100":"opacity-50"),children:[(0,n.jsxs)(s.Zb,{className:"bg-green-950/40 border-green-800",children:[(0,n.jsxs)(s.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsx)(s.ll,{className:"text-sm font-medium text-green-300",children:"BETH Balance"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[j&&(0,n.jsx)(d.Z,{className:"h-3 w-3 text-green-400 animate-spin"}),(0,n.jsx)(m.Z,{className:"h-4 w-4 text-yellow-400"})]})]}),(0,n.jsxs)(s.aY,{className:"space-y-3",children:[(0,n.jsx)("div",{className:"text-xl font-bold text-yellow-300 font-mono",children:e?j?"...":y:"---.----"}),(0,n.jsx)("p",{className:"text-xs text-gray-400",children:"Burned ETH tokens"}),E&&(0,n.jsx)("p",{className:"text-xs text-red-400",children:"Error loading balance"}),(0,n.jsx)(eh,{onBurnComplete:()=>{console.log("[v0] Burn completed, balances will refresh automatically")},children:(0,n.jsxs)(o.z,{size:"sm",variant:"outline",className:"border-green-600 text-green-300 hover:bg-green-900/50 bg-transparent w-full",children:["Burn ETH",(0,n.jsx)(m.Z,{className:"ml-2 w-4 h-4"})]})}),(0,n.jsx)("p",{className:"text-xs text-gray-400 text-center",children:"Max 1 ETH per transaction"})]})]}),(0,n.jsxs)(s.Zb,{className:"bg-green-950/40 border-green-800",children:[(0,n.jsxs)(s.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsx)(s.ll,{className:"text-sm font-medium text-green-300",children:"WORM Balance"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[j&&(0,n.jsx)(d.Z,{className:"h-3 w-3 text-green-400 animate-spin"}),(0,n.jsx)(u.Z,{className:"h-4 w-4 text-green-400"})]})]}),(0,n.jsxs)(s.aY,{className:"space-y-3",children:[(0,n.jsx)("div",{className:"text-xl font-bold text-green-300 font-mono",children:e?j?"...":N:"---.----"}),(0,n.jsx)("p",{className:"text-xs text-gray-400",children:"Mined WORM tokens"}),E&&(0,n.jsx)("p",{className:"text-xs text-red-400",children:"Error loading balance"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,n.jsx)(V,{bethBalance:y,currentEpoch:S,children:(0,n.jsxs)(o.z,{size:"sm",variant:"outline",className:"border-blue-600 text-blue-300 hover:bg-blue-900/50 bg-transparent",disabled:!e,children:[(0,n.jsx)(p.Z,{className:"w-3 h-3 mr-1"}),"Participate"]})}),(0,n.jsx)(K,{currentEpoch:S,children:(0,n.jsxs)(o.z,{size:"sm",variant:"outline",className:"border-purple-600 text-purple-300 hover:bg-purple-900/50 bg-transparent",disabled:!e,children:[(0,n.jsx)(g.Z,{className:"w-3 h-3 mr-1"}),"Claim"]})})]})]})]})]})})})}),(0,n.jsx)(r.BurnActivity,{})]})}function ex(){return(0,n.jsx)(b.NetworkProvider,{children:(0,n.jsx)(y,{children:(0,n.jsx)(ef,{})})})}}},function(e){e.O(0,[226,715,140,971,117,744],function(){return e(e.s=6270)}),_N_E=e.O()}]);