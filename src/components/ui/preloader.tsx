'use client';

import { AnimatePresence, motion } from 'motion/react';

import { useScrollLock } from '@/hooks';
import { Dispatch, SetStateAction, useEffect, useState } from 'react';
import { CountingNumber } from './counter';

const PATHS = [
  'M531.469 28.7682L542.031 39.372C543.773 41.1204 546.116 42.089 548.571 42.089C550.401 42.089 552.18 41.5481 553.709 40.5292L555.362 39.4223L544.8 28.8185C543.058 27.0827 540.703 26.1016 538.26 26.1016C536.43 26.1016 534.651 26.6424 533.123 27.6613L531.469 28.7682Z',
  'M514.859 28.7682L525.422 39.372C527.163 41.1204 529.506 42.089 531.962 42.089C533.791 42.089 535.571 41.5481 537.099 40.5292L538.753 39.4223L528.191 28.8185C526.449 27.0827 524.094 26.1016 521.65 26.1016C519.821 26.1016 518.042 26.6424 516.513 27.6613L514.859 28.7682Z',
  'M498.25 28.7682L508.812 39.372C510.554 41.1204 512.897 42.089 515.353 42.089C517.182 42.089 518.961 41.5481 520.49 40.5292L522.144 39.4223L511.581 28.8185C509.84 27.0827 507.484 26.1016 505.041 26.1016C503.212 26.1016 501.432 26.6424 499.904 27.6613L498.25 28.7682Z',
  'M481.645 28.7682L492.207 39.372C493.948 41.1204 496.291 42.089 498.747 42.089C500.577 42.089 502.356 41.5481 503.884 40.5292L505.538 39.4223L494.976 28.8185C493.234 27.0827 490.879 26.1016 488.435 26.1016C486.606 26.1016 484.827 26.6424 483.298 27.6613L481.645 28.7682Z',
  'M465.035 28.7682L475.597 39.372C477.339 41.1204 479.682 42.089 482.138 42.089C483.967 42.089 485.746 41.5481 487.275 40.5292L488.929 39.4223L478.366 28.8185C476.625 27.0827 474.269 26.1016 471.826 26.1016C469.997 26.1016 468.218 26.6424 466.689 27.6613L465.035 28.7682Z',
  'M448.426 28.7682L458.988 39.372C460.73 41.1204 463.073 42.089 465.528 42.089C467.358 42.089 469.137 41.5481 470.666 40.5292L472.319 39.4223L461.757 28.8185C460.016 27.0827 457.66 26.1016 455.217 26.1016C453.387 26.1016 451.608 26.6424 450.08 27.6613L448.426 28.7682Z',
  'M431.82 28.7682L442.383 39.372C444.124 41.1204 446.467 42.089 448.923 42.089C450.752 42.089 452.531 41.5481 454.06 40.5292L455.714 39.4223L445.152 28.8185C443.41 27.0827 441.055 26.1016 438.611 26.1016C436.782 26.1016 435.003 26.6424 433.474 27.6613L431.82 28.7682Z',
  'M415.211 28.7682L425.773 39.372C427.515 41.1204 429.858 42.089 432.314 42.089C434.143 42.089 435.922 41.5481 437.451 40.5292L439.105 39.4223L428.542 28.8185C426.801 27.0827 424.445 26.1016 422.002 26.1016C420.173 26.1016 418.393 26.6424 416.865 27.6613L415.211 28.7682Z',
  'M398.602 28.7682L409.164 39.372C410.905 41.1204 413.248 42.089 415.704 42.089C417.534 42.089 419.313 41.5481 420.841 40.5292L422.495 39.4223L411.933 28.8185C410.191 27.0827 407.836 26.1016 405.393 26.1016C403.563 26.1016 401.784 26.6424 400.255 27.6613L398.602 28.7682Z',
  'M381.992 28.7682L392.555 39.372C394.296 41.1204 396.639 42.089 399.095 42.089C400.924 42.089 402.703 41.5481 404.232 40.5292L405.886 39.4223L395.324 28.8185C393.582 27.0827 391.226 26.1016 388.783 26.1016C386.954 26.1016 385.175 26.6424 383.646 27.6613L381.992 28.7682Z',
  'M365.383 28.7682L375.945 39.372C377.687 41.1204 380.03 42.089 382.486 42.089C384.315 42.089 386.094 41.5481 387.623 40.5292L389.276 39.4223L378.714 28.8185C376.973 27.0827 374.617 26.1016 372.174 26.1016C370.344 26.1016 368.565 26.6424 367.037 27.6613L365.383 28.7682Z',
  'M348.777 28.7682L359.34 39.372C361.081 41.1204 363.424 42.089 365.88 42.089C367.709 42.089 369.489 41.5481 371.017 40.5292L372.671 39.4223L362.109 28.8185C360.367 27.0827 358.012 26.1016 355.568 26.1016C353.739 26.1016 351.96 26.6424 350.431 27.6613L348.777 28.7682Z',
  'M332.168 28.7682L342.73 39.372C344.472 41.1204 346.815 42.089 349.271 42.089C351.1 42.089 352.879 41.5481 354.408 40.5292L356.062 39.4223L345.499 28.8185C343.758 27.0827 341.402 26.1016 338.959 26.1016C337.13 26.1016 335.35 26.6424 333.822 27.6613L332.168 28.7682Z',
  'M315.559 28.7682L326.121 39.372C327.863 41.1204 330.206 42.089 332.661 42.089C334.491 42.089 336.27 41.5481 337.798 40.5292L339.452 39.4223L328.89 28.8185C327.148 27.0827 324.793 26.1016 322.35 26.1016C320.52 26.1016 318.741 26.6424 317.212 27.6613L315.559 28.7682Z',
  'M298.953 28.7682L309.515 39.372C311.257 41.1204 313.6 42.089 316.056 42.089C317.885 42.089 319.664 41.5481 321.193 40.5292L322.847 39.4223L312.284 28.8185C310.543 27.0827 308.187 26.1016 305.744 26.1016C303.915 26.1016 302.136 26.6424 300.607 27.6613L298.953 28.7682Z',
  'M282.344 28.7682L292.906 39.372C294.648 41.1204 296.991 42.089 299.446 42.089C301.276 42.089 303.055 41.5481 304.584 40.5292L306.237 39.4223L295.675 28.8185C293.933 27.0827 291.578 26.1016 289.135 26.1016C287.305 26.1016 285.526 26.6424 283.998 27.6613L282.344 28.7682Z',
  'M265.734 28.7682L276.297 39.372C278.038 41.1204 280.381 42.089 282.837 42.089C284.666 42.089 286.446 41.5481 287.974 40.5292L289.628 39.4223L279.066 28.8185C277.324 27.0827 274.969 26.1016 272.525 26.1016C270.696 26.1016 268.917 26.6424 267.388 27.6613L265.734 28.7682Z',
  'M249.125 28.7682L259.687 39.372C261.429 41.1204 263.772 42.089 266.228 42.089C268.057 42.089 269.836 41.5481 271.365 40.5292L273.019 39.4223L262.456 28.8185C260.715 27.0827 258.359 26.1016 255.916 26.1016C254.087 26.1016 252.307 26.6424 250.779 27.6613L249.125 28.7682Z',
  'M232.516 28.7682L243.078 39.372C244.82 41.1204 247.163 42.089 249.618 42.089C251.448 42.089 253.227 41.5481 254.755 40.5292L256.409 39.4223L245.847 28.8185C244.105 27.0827 241.75 26.1016 239.307 26.1016C237.477 26.1016 235.698 26.6424 234.17 27.6613L232.516 28.7682Z',
  'M215.91 28.7682L226.472 39.372C228.214 41.1204 230.557 42.089 233.013 42.089C234.842 42.089 236.621 41.5481 238.15 40.5292L239.804 39.4223L229.241 28.8185C227.5 27.0827 225.144 26.1016 222.701 26.1016C220.872 26.1016 219.093 26.6424 217.564 27.6613L215.91 28.7682Z',
  'M199.301 28.7682L209.863 39.372C211.605 41.1204 213.948 42.089 216.403 42.089C218.233 42.089 220.012 41.5481 221.541 40.5292L223.194 39.4223L212.632 28.8185C210.891 27.0827 208.535 26.1016 206.092 26.1016C204.262 26.1016 202.483 26.6424 200.955 27.6613L199.301 28.7682Z',
  'M182.691 28.7682L193.254 39.372C194.995 41.1204 197.338 42.089 199.794 42.089C201.623 42.089 203.403 41.5481 204.931 40.5292L206.585 39.4223L196.023 28.8185C194.281 27.0827 191.926 26.1016 189.482 26.1016C187.653 26.1016 185.874 26.6424 184.345 27.6613L182.691 28.7682Z',
  'M166.086 28.7682L176.648 39.372C178.39 41.1204 180.733 42.089 183.189 42.089C185.018 42.089 186.797 41.5481 188.326 40.5292L189.98 39.4223L179.417 28.8185C177.676 27.0827 175.32 26.1016 172.877 26.1016C171.048 26.1016 169.268 26.6424 167.74 27.6613L166.086 28.7682Z',
  'M149.477 28.7682L160.039 39.372C161.78 41.1204 164.123 42.089 166.579 42.089C168.409 42.089 170.188 41.5481 171.716 40.5292L173.37 39.4223L162.808 28.8185C161.066 27.0827 158.711 26.1016 156.268 26.1016C154.438 26.1016 152.659 26.6424 151.13 27.6613L149.477 28.7682Z',
  'M132.867 28.7682L143.43 39.372C145.171 41.1204 147.514 42.089 149.97 42.089C151.799 42.089 153.578 41.5481 155.107 40.5292L156.761 39.4223L146.199 28.8185C144.457 27.0827 142.101 26.1016 139.658 26.1016C137.829 26.1016 136.05 26.6424 134.521 27.6613L132.867 28.7682Z',
  'M116.258 28.7682L126.82 39.372C128.562 41.1204 130.905 42.089 133.361 42.089C135.19 42.089 136.969 41.5481 138.498 40.5292L140.151 39.4223L129.589 28.8185C127.848 27.0827 125.492 26.1016 123.049 26.1016C121.219 26.1016 119.44 26.6424 117.912 27.6613L116.258 28.7682Z',
  'M99.6484 28.7682L110.211 39.372C111.952 41.1204 114.295 42.089 116.751 42.089C118.58 42.089 120.36 41.5481 121.888 40.5292L123.542 39.4223L112.98 28.8185C111.238 27.0827 108.883 26.1016 106.439 26.1016C104.61 26.1016 102.831 26.6424 101.302 27.6613L99.6484 28.7682Z',
  'M83.043 28.7682L93.6053 39.372C95.3469 41.1204 97.6899 42.089 100.146 42.089C101.975 42.089 103.754 41.5481 105.283 40.5292L106.937 39.4223L96.3743 28.8185C94.6327 27.0827 92.2772 26.1016 89.8339 26.1016C88.0046 26.1016 86.2254 26.6424 84.6969 27.6613L83.043 28.7682Z',
  'M66.4336 28.7682L76.9959 39.372C78.7375 41.1204 81.0805 42.089 83.5363 42.089C85.3656 42.089 87.1448 41.5481 88.6734 40.5292L90.3272 39.4223L79.7649 28.8185C78.0233 27.0827 75.6678 26.1016 73.2246 26.1016C71.3953 26.1016 69.6161 26.6424 68.0875 27.6613L66.4336 28.7682Z',
  'M49.8242 28.7682L60.3865 39.372C62.1281 41.1204 64.4711 42.089 66.9269 42.089C68.7562 42.089 70.5354 41.5481 72.064 40.5292L73.7179 39.4223L63.1555 28.8185C61.414 27.0827 59.0584 26.1016 56.6152 26.1016C54.7859 26.1016 53.0067 26.6424 51.4781 27.6613L49.8242 28.7682Z',
  'M33.2188 28.7682L43.7811 39.372C45.5227 41.1204 47.8657 42.089 50.3214 42.089C52.1507 42.089 53.9299 41.5481 55.4585 40.5292L57.1124 39.4223L46.5501 28.8185C44.8085 27.0827 42.453 26.1016 40.0097 26.1016C38.1804 26.1016 36.4012 26.6424 34.8726 27.6613L33.2188 28.7682Z',
  'M16.6094 28.7682L27.1717 39.372C28.9133 41.1204 31.2563 42.089 33.7121 42.089C35.5414 42.089 37.3205 41.5481 38.8491 40.5292L40.503 39.4223L29.9407 28.8185C28.1991 27.0827 25.8436 26.1016 23.4003 26.1016C21.571 26.1016 19.7919 26.6424 18.2633 27.6613L16.6094 28.7682Z',
  'M0 28.7682L10.5623 39.372C12.3039 41.1204 14.6469 42.089 17.1027 42.089C18.932 42.089 20.7112 41.5481 22.2398 40.5292L23.8937 39.4223L13.3313 28.8185C11.5897 27.0827 9.2342 26.1016 6.79096 26.1016C4.96166 26.1016 3.18248 26.6424 1.65389 27.6613L0 28.7682Z',
];

type PreloaderProps = {
  setLoaded: Dispatch<SetStateAction<boolean>>;
};

export function Preloader({ setLoaded }: PreloaderProps) {
  useScrollLock({ autoLock: true });

  const [pageLoaded, setPageLoaded] = useState(false);
  const [timesUp, setTimesUp] = useState(false);

  useEffect(() => {
    setPageLoaded(true);
  }, []);

  useEffect(() => {
    if (pageLoaded) {
      setTimeout(() => {
        setTimesUp(true);
      }, 2000);
    }
  }, [pageLoaded]);

  useEffect(() => {
    if (pageLoaded && timesUp) {
      const timeout = setTimeout(() => {
        setLoaded(true);
      }, 500);
      return () => clearTimeout(timeout);
    }
  }, [pageLoaded, timesUp, setLoaded]);

  const lineStart = { x: 15, y: 0 };
  const lineEnd = { x: -485, y: 0 };

  return (
    <AnimatePresence>
      {!timesUp ? (
        <motion.div
          initial={{ y: 0 }}
          animate={{ y: 0 }}
          exit={{ y: '-100%' }}
          transition={{
            type: 'spring',
            stiffness: 100,
            damping: 20,
            mass: 1,
          }}
          className="fixed inset-0 z-50 flex items-center justify-center bg-black"
        >
          <div className="relative flex flex-col items-center gap-2">
            <motion.svg width="600" height="69" viewBox="0 0 600 69" fill="none" className="max-w-full">
              <defs>
                <filter
                  id="filter0_f_586_8828"
                  x="471.9"
                  y="0.00156212"
                  width="101.2"
                  height="68.2"
                  filterUnits="userSpaceOnUse"
                  colorInterpolationFilters="sRGB"
                >
                  <feFlood floodOpacity="0" result="BackgroundImageFix" />
                  <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                  <feGaussianBlur stdDeviation="13.05" result="effect1_foregroundBlur_586_8828" />
                </filter>
              </defs>

              <motion.g transform="translate(13, 0)" origin="center">
                {PATHS.map((d, i) => (
                  <motion.path
                    key={i}
                    d={d}
                    initial={{ fillOpacity: 0.2 }}
                    animate={{ fillOpacity: 1 }}
                    transition={{
                      delay: (2 / PATHS.length) * (i + 1),
                      ease: 'easeInOut',
                    }}
                    fill="#00C871"
                  />
                ))}
              </motion.g>

              <motion.g
                initial={{ x: lineStart.x, y: lineStart.y }}
                animate={{
                  x: lineEnd.x,
                  y: lineEnd.y,
                }}
                transition={{
                  duration: 2,
                  ease: 'easeInOut',
                }}
                filter="url(#filter0_f_586_8828)"
              >
                <rect x="498" y="26.1016" width="49" height="16" fill="#00C871" fill-opacity="0.4" />
              </motion.g>

              <motion.g
                initial={{ x: lineStart.x, y: lineStart.y }}
                animate={{
                  x: lineEnd.x,
                  y: lineEnd.y,
                }}
                transition={{
                  duration: 2,
                  ease: 'easeInOut',
                }}
                // filter="url(#filter0_f_586_8828)"
              >
                <path
                  d="M510.688 27.4978C509.798 26.6047 508.583 26.1016 507.33 26.1016H504.661C503.37 26.1016 502.205 26.6299 501.366 27.4726C500.526 28.3154 500 29.4852 500 30.7682C500 33.3468 502.08 35.4349 504.648 35.4349H504.811C505.977 35.4349 507.104 35.9003 507.931 36.7305L511.114 39.9255C511.815 40.6173 512.63 41.1707 513.519 41.5355C514.409 41.9003 515.374 42.1016 516.351 42.1016C517.817 42.1016 519.245 41.6613 520.461 40.8563L522.578 39.4349L510.688 27.4978ZM506.064 32.177C505.701 32.5418 505.212 32.7682 504.661 32.7682C503.558 32.7682 502.669 31.8751 502.669 30.7682C502.669 29.6613 502.894 29.7116 503.258 29.3594C503.621 28.9946 504.122 28.7682 504.661 28.7682C505.2 28.7682 505.713 28.9946 506.064 29.3594C506.428 29.7242 506.653 30.2273 506.653 30.7682C506.653 31.3091 506.428 31.8248 506.064 32.177Z"
                  fill="#00C871"
                />
                <path
                  d="M514.609 28.7682L525.172 39.372C526.913 41.1204 529.256 42.089 531.712 42.089C533.541 42.089 535.321 41.5481 536.849 40.5292L538.503 39.4223L527.941 28.8185C526.199 27.0827 523.844 26.1016 521.4 26.1016C519.571 26.1016 517.792 26.6424 516.263 27.6613L514.609 28.7682Z"
                  fill="#00C871"
                />
                <path
                  d="M530.824 28.5921L540.121 38.3406L548.102 32.5921L544.231 28.8185C542.452 27.0827 540.058 26.1016 537.565 26.1016C535.773 26.1016 534.007 26.6047 532.491 27.5607L530.837 28.5921H530.824Z"
                  fill="#00C871"
                />
              </motion.g>
            </motion.svg>

            <motion.div
              initial={{ scale: 0.8, opacity: 0 }}
              animate={{ scale: 1, opacity: 1 }}
              transition={{
                type: 'spring',
                stiffness: 200,
                damping: 15,
              }}
              className="absolute top-14 flex items-center justify-center gap-0.5 font-orbitron text-base font-bold text-green-500"
            >
              <CountingNumber
                number={100}
                style={{
                  textShadow:
                    '0 0 0px rgba(150,250,209,0.5), 0 0 5px rgba(150,250,209,0.5), 0 0 10px rgba(150,250,209,0.5), 0 0 20px rgba(150,250,209,0.5)',
                }}
              />
              %
            </motion.div>
          </div>
        </motion.div>
      ) : null}
    </AnimatePresence>
  );
}
